(()=>{"use strict";(()=>{const e=(e=document,t)=>e.querySelector(t);function t(){const e=this.node,t=Array.from((new DOMParser).parseFromString(this.template(),"text/html").body.children),s=new DocumentFragment;s.append(...t),e.after(s),this.node=e.nextSibling;const n=e.classList.value.trim(),i=this.node.classList.value.trim(),a=n!==i&&i||n;a?(this.node.className=a,e.remove()):e.remove()}var s=function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{o(n.next(e))}catch(e){a(e)}}function l(e){try{o(n.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,l)}o((n=n.apply(e,t||[])).next())}))};class n{constructor({node:e,initalState:t,renderStateKey:s=[]}){this.node=e,this.initalState=t,this.renderStateKey=new Set(s),this.subscribers=new Set([]),this.isNeedRender=!1,this.isNeedUpdate=!1,this.setup(),this.render()}setup(){}render(){window.requestAnimationFrame((()=>{t.call(this),this.setEvent(),this.renderChildComponent()}))}updater(){this.isNeedRender?(this.clearEvent(),this.render()):this.renderChildComponent()}renderChildComponent(){}setEvent(){}clearEvent(){}template(){return""}subscribe(...e){e.forEach((e=>{this.subscribers.add(e)}))}notify(e){Array.from(this.subscribers).forEach((t=>{t.setState(e),t.updater(),t.isNeedRender=!1}))}setState(e){this.checkUpdataState(e),this.isNeedUpdate&&(this.reflectNeedRender(e),this.reflectState(e),this.notify(e),((e,t)=>{try{localStorage.setItem("searchState",JSON.stringify(t))}catch(e){throw new Error("저장이 되지 않았습니다!")}})(0,this.initalState))}checkUpdataState(e){const t=JSON.stringify(Object.assign({},this.initalState)),s=JSON.stringify(Object.assign(Object.assign({},this.initalState),e));this.isNeedUpdate=t!==s}reflectNeedRender(e){const t=Object.keys(e),s=Array.from(this.renderStateKey),n=t.filter((e=>s.includes(e)));this.isNeedRender=0===n.length}reflectState(e){Object.keys(e).forEach((t=>{const s=t;this.initalState[s]=e[s]}))}}const i={SearchInput__input:"oZFdS8AMjR5RMYyBNvKV"};class a extends n{template(){const{SearchInput__input:e}=i,{keyword:t}=this.initalState;return`\n      <input class='${e}' type='text' placeholder='웹툰제목, 작가이름으로 검색' value='${t}'/>\n    `}setup(){const{onInput:e}=this.initalState;this.handleInput=t=>{e(t.target.value)},this.handleFocus=()=>{this.node.focus()}}setEvent(){this.node.addEventListener("input",this.handleInput),this.handleFocus()}clearEvent(){this.node.removeEventListener("input",this.handleInput)}}const r={result_list:"hjCdco27lJJTo2oyRN5w",selected:"yqBqWxiR9AStGB58rLfS",matched:"OAf5JwkD9oSOJWplWK_0"};class l extends n{template(){var e;const{selectedIndex:t,isResultListVisiable:s,listData:n,keyword:i}=this.initalState,{result_list:a,selected:l,matched:o}=r,c=(e,t)=>{if(!e.includes(t))return e;const s=e.match(new RegExp(t,"gi"))[0];return e.replace(new RegExp(s,"gi"),`<span class='${o}'>${s}</span>`)};return`\n      <ul class='${s?`${a}`:"hide"}'>\n      ${null===(e=Array.from(n))||void 0===e?void 0:e.map(((e,s)=>`<li class='${s===t?`${l}`:""}' data-index='${s}'>\n              <span>${c(e.title,i)}</span>\n              <span>[ ${c(e.author,i)} ] </span>\n            </li>`)).join("")}\n      </ul>\n    `}setup(){const{onClick:e}=this.initalState;this.handleClick=t=>{const s=t.target.closest("li");if(s){const{index:t}=s.dataset;e(this.initalState.listData[parseInt(t)],t)}}}setEvent(){this.node.addEventListener("click",this.handleClick);const{selectedIndex:e}=this.initalState;(e>0&&e<=3||0===e)&&this.node.scrollTo(0,0),e>3&&this.node.scrollTo(0,40.5*(e-3))}clearEvent(){this.node.removeEventListener("click",this.handleClick)}}class o extends n{template(){const{isModalVisiable:e,selectedItem:t}=this.initalState;return`\n    <div>\n    ${e?`\n      <div class='item_info' >\n        <div class='modal'>\n          <button>X</button> \n          <a href='${t.url}' target='_blank'>\n            <img src='${t.img}' />\n          </a>\n          <p>웹툰 제목: ${t.title}</p>\n          <p>작가: ${t.author}</p>\n          <p>연재 사이트: ${t.service}</p>\n        </div>\n      </div>\n      `:""}\n    </div>\n    `}}const c={error_meg:"mawL5jYPblmXxcwJ7f3X",up:"EA5KfYSJlSA5Ljg3Wyns"};class d extends n{template(){const{isErrorMeg:e,keyword:t}=this.initalState,{error_meg:s}=c;return`\n    <div class='${s}'>\n    ${e?0===t.length?"<span>검색어를 입력해주세요 :)</span>":"<span><strong>'두 글자'</strong> 부터 검색이 가능합니다 :)</span>":""}\n    </div>\n    `}}new class extends n{constructor({node:e}){super({node:e,initalState:{keyword:"",selectedIndex:0,listData:[],selectedItem:{},isResultListVisiable:!1,isModalVisiable:!1,isErrorMeg:!0}})}setup(){this.setState(Object.assign(Object.assign({},this.initalState),(e=>{try{const e=localStorage.getItem("searchState");return e?JSON.parse(e):[]}catch(e){throw new Error(e)}})())),this.handleChange=((e,t)=>{let s;return t=>{s&&clearTimeout(s),s=window.setTimeout(e,300,t)}})((e=>{return t=this,n=void 0,a=function*(){const t=yield(e=>s(void 0,void 0,void 0,(function*(){return t=`https://korea-webtoon-api.herokuapp.com/search?keyword=${e}`,s(void 0,void 0,void 0,(function*(){try{const e=yield fetch(t);if(!e.ok)throw new Error("서버와의 연결이 불안정합니다!");return(yield e.json()).webtoons}catch(e){console.error(`에러가 발생했습니다! ${e.message}`)}}));var t})))(e);e?e.length<2&&e.length>0?this.setState({isResultListVisiable:!1,isErrorMeg:!0,keyword:e}):this.setState({isResultListVisiable:t.length>0,listData:t,keyword:e,isErrorMeg:!1}):this.setState({isResultListVisiable:!1,selectedIndex:0,keyword:"",listData:t.length?t:[],selectedItem:{}})},new((i=void 0)||(i=Promise))((function(e,s){function r(e){try{o(a.next(e))}catch(e){s(e)}}function l(e){try{o(a.throw(e))}catch(e){s(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,l)}o((a=a.apply(t,n||[])).next())}));var t,n,i,a})),this.handleKeyChange=e=>{const{listData:t,selectedIndex:s}=this.initalState,n={ARROWUP:"ArrowUp",ARROWDOWN:"ArrowDown",ENTER:"Enter",ESCAPE:"Escape"};if(Object.values(n).includes(e.key)&&!t.length)return;const i=t.length-1;let a=s;switch(e.key){case n.ARROWUP:a=0===s?i:a-1,this.setState({selectedIndex:a});break;case n.ARROWDOWN:a=s===i?0:a+1,this.setState({selectedIndex:a});break;case n.ENTER:e.preventDefault(),this.setState({selectedItem:t[s],isModalVisiable:!0});break;case n.ESCAPE:this.setState({isModalVisiable:!1})}},this.handleClick=e=>{(e.target.closest("button")||e.target.classList.contains("item_info"))&&this.setState({isModalVisiable:!1})}}template(){return"\n      <main id='root'>\n        <header class='header'>Webtoons Search</header>\n        <div class='container'>\n          <SearchInput></SearchInput>\n          <ErrorMessage></ErrorMessage>\n          <SearchResultList></SearchResultList>\n          <SearchItemInfo></SearchItemInfo>\n        </div>\n      </main>\n  "}renderChildComponent(){const{keyword:t,selectedIndex:s,listData:n,isResultListVisiable:i,selectedItem:r,isModalVisiable:c,isErrorMeg:h}=this.initalState;new a({node:e(this.node,"SearchInput"),initalState:{keyword:this.initalState.keyword,onInput:this.handleChange}});const u=new d({node:e(this.node,"ErrorMessage"),renderStateKey:["selectedItem","selectedIndex"],initalState:{isErrorMeg:h,keyword:t}}),p=new l({node:e(this.node,"SearchResultList"),initalState:{keyword:t,listData:n,isResultListVisiable:i,selectedIndex:s,onClick:(e,t)=>{this.setState({selectedItem:e,isModalVisiable:!0,selectedIndex:Number(t)})}}}),S=new o({node:e(this.node,"SearchItemInfo"),initalState:{selectedItem:r,isModalVisiable:c}});this.subscribe(p),this.subscribe(S),this.subscribe(u)}setEvent(){window.addEventListener("keyup",this.handleKeyChange),this.node.addEventListener("click",this.handleClick)}clearEvent(){window.removeEventListener("keyup",this.handleKeyChange),this.node.removeEventListener("click",this.handleClick)}}({node:e(document,"#root"),initalState:null})})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TSxDQUFFaEcsS0FBTVIsRUFBU0UsU0FBVSxTQUFVOEIsWUFBYSxNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL3V0aWxzL2RvbS9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9jb3JlL0NvbXBvbmVudC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvdXRpbHMvc3RvcmFnZS9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9zZWFyY2gvU2VhcmNoSW5wdXQvU2VhcmNoSW5wdXQubW9kdWxlLnNjc3M/MTQ3MSIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9zZWFyY2gvU2VhcmNoSW5wdXQvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvc2VhcmNoL1NlYXJjaFJlc3VsdC9TZWFyY2hSZXN1bHQubW9kdWxlLnNjc3M/MWFiOSIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9zZWFyY2gvU2VhcmNoUmVzdWx0L2luZGV4LnRzIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy9jb21wb25lbnRzL3NlYXJjaC9TZWFyY2hJdGVtSW5mby9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9tZXNzYWdlL0Vycm9yTWVnL0Vycm9yTWVnLm1vZHVsZS5zY3NzPzBhM2YiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvbWVzc2FnZS9FcnJvck1lZy9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvQXBwLnRzIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy91dGlscy9oZWxwZXJzL2luZGV4LnRzIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy9hcGkvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbnN0YW50cy9hcGkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2VsZWN0RWwgPSAoXG4gIHNjb3BlOiBFbGVtZW50IHwgRG9jdW1lbnQgPSBkb2N1bWVudCxcbiAgc2VsZWN0b3I6IHN0cmluZ1xuKTogRWxlbWVudCA9PiB7XG4gIHJldHVybiBzY29wZS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKVxufVxuXG5jb25zdCBzZWxlY3RBbGwgPSAoeyBzY29wZSwgc2VsZWN0b3IgfTogSVNlbGVjdFR5cGUpOiBFbGVtZW50W10gPT4ge1xuICByZXR1cm4gQXJyYXkuZnJvbShzY29wZS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSlcbn1cblxuY29uc3QgY3JlYXRlRWwgPSAodGFnTmFtZTogc3RyaW5nKTogRWxlbWVudCA9PiB7XG4gIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpXG59XG5cbmZ1bmN0aW9uIENvbnZlcnRUZW1wbGF0ZVRvQ29tcG9uZW50KHRoaXM6IGFueSk6IHZvaWQge1xuICBjb25zdCBvbGROb2RlID0gdGhpcy5ub2RlXG4gIGNvbnN0IGNvbXBvbmVudENoaWxkcmVuID0gQXJyYXkuZnJvbShcbiAgICBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHRoaXMudGVtcGxhdGUoKSwgJ3RleHQvaHRtbCcpLmJvZHkuY2hpbGRyZW5cbiAgKVxuICBjb25zdCBjb21wb25lbnQgPSBuZXcgRG9jdW1lbnRGcmFnbWVudCgpXG4gIGNvbXBvbmVudC5hcHBlbmQoLi4uY29tcG9uZW50Q2hpbGRyZW4pXG5cbiAgb2xkTm9kZS5hZnRlcihjb21wb25lbnQpXG4gIHRoaXMubm9kZSA9IG9sZE5vZGUubmV4dFNpYmxpbmdcblxuICBjb25zdCBvbGRDU1MgPSBvbGROb2RlLmNsYXNzTGlzdC52YWx1ZS50cmltKClcbiAgY29uc3QgbmV3Q1NTID0gdGhpcy5ub2RlLmNsYXNzTGlzdC52YWx1ZS50cmltKClcbiAgY29uc3QgaXNDaGFuZ2VkQ1NTID0gb2xkQ1NTICE9PSBuZXdDU1NcbiAgY29uc3QgY3NzVmFsdWUgPSBpc0NoYW5nZWRDU1MgPyBuZXdDU1MgfHwgb2xkQ1NTIDogb2xkQ1NTXG5cbiAgaWYgKCFjc3NWYWx1ZSkge1xuICAgIG9sZE5vZGUucmVtb3ZlKClcbiAgICByZXR1cm5cbiAgfVxuXG4gIHRoaXMubm9kZS5jbGFzc05hbWUgPSBjc3NWYWx1ZVxuXG4gIG9sZE5vZGUucmVtb3ZlKClcbn1cblxuZXhwb3J0IHsgY3JlYXRlRWwsIHNlbGVjdEVsLCBzZWxlY3RBbGwsIENvbnZlcnRUZW1wbGF0ZVRvQ29tcG9uZW50IH1cblxuaW50ZXJmYWNlIElTZWxlY3RUeXBlIHtcbiAgc2NvcGU6IEVsZW1lbnQgfCBEb2N1bWVudFxuICBzZWxlY3Rvcjogc3RyaW5nXG59XG4iLCJpbXBvcnQgeyBDb252ZXJ0VGVtcGxhdGVUb0NvbXBvbmVudCwgc2V0SXRlbSB9IGZyb20gJ0B1dGlscydcblxuZXhwb3J0IGRlZmF1bHQgYWJzdHJhY3QgY2xhc3MgQ29tcG9uZW50PFN0YXRlVHlwZT4ge1xuICBub2RlOiBFbGVtZW50XG4gIGluaXRhbFN0YXRlOiBTdGF0ZVR5cGVcbiAgcmVuZGVyU3RhdGVLZXk6IFNldDxzdHJpbmc+XG4gIHN1YnNjcmliZXJzOiBTZXQ8YW55PlxuICBpc05lZWRSZW5kZXI6IGJvb2xlYW5cbiAgaXNOZWVkVXBkYXRlOiBib29sZWFuXG4gIGNvbnN0cnVjdG9yKHtcbiAgICBub2RlLFxuICAgIGluaXRhbFN0YXRlLFxuICAgIHJlbmRlclN0YXRlS2V5ID0gW11cbiAgfTogSUNvbXBvbmVudFByb3BzPFN0YXRlVHlwZT4pIHtcbiAgICB0aGlzLm5vZGUgPSBub2RlXG4gICAgdGhpcy5pbml0YWxTdGF0ZSA9IGluaXRhbFN0YXRlXG4gICAgdGhpcy5yZW5kZXJTdGF0ZUtleSA9IG5ldyBTZXQocmVuZGVyU3RhdGVLZXkpXG4gICAgdGhpcy5zdWJzY3JpYmVycyA9IG5ldyBTZXQoW10pXG4gICAgdGhpcy5pc05lZWRSZW5kZXIgPSBmYWxzZVxuICAgIHRoaXMuaXNOZWVkVXBkYXRlID0gZmFsc2VcblxuICAgIHRoaXMuc2V0dXAoKVxuICAgIHRoaXMucmVuZGVyKClcbiAgfVxuXG4gIHNldHVwKCk6IHZvaWQge1xuICAgIHJldHVyblxuICB9XG5cbiAgcmVuZGVyKCk6IHZvaWQge1xuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgQ29udmVydFRlbXBsYXRlVG9Db21wb25lbnQuY2FsbCh0aGlzKVxuICAgICAgdGhpcy5zZXRFdmVudCgpXG4gICAgICB0aGlzLnJlbmRlckNoaWxkQ29tcG9uZW50KClcbiAgICB9KVxuICB9XG5cbiAgdXBkYXRlcigpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaXNOZWVkUmVuZGVyKSB7XG4gICAgICB0aGlzLnJlbmRlckNoaWxkQ29tcG9uZW50KClcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMuY2xlYXJFdmVudCgpXG4gICAgdGhpcy5yZW5kZXIoKVxuICB9XG5cbiAgcmVuZGVyQ2hpbGRDb21wb25lbnQoKTogdm9pZCB7XG4gICAgcmV0dXJuXG4gIH1cblxuICBzZXRFdmVudCgpOiB2b2lkIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIGNsZWFyRXZlbnQoKTogdm9pZCB7XG4gICAgcmV0dXJuXG4gIH1cblxuICB0ZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiAnJ1xuICB9XG5cbiAgc3Vic2NyaWJlKC4uLnN1YnNjcmliZXJzOiBhbnlbXSk6IHZvaWQge1xuICAgIHN1YnNjcmliZXJzLmZvckVhY2goc3Vic2NyaWJlciA9PiB7XG4gICAgICB0aGlzLnN1YnNjcmliZXJzLmFkZChzdWJzY3JpYmVyKVxuICAgIH0pXG4gIH1cblxuICBub3RpZnkobmV3U3RhdGU6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IHN1YnNjcmliZXJzID0gQXJyYXkuZnJvbSh0aGlzLnN1YnNjcmliZXJzKVxuXG4gICAgc3Vic2NyaWJlcnMuZm9yRWFjaChzdWJzY3JpYmVyID0+IHtcbiAgICAgIHN1YnNjcmliZXIuc2V0U3RhdGUobmV3U3RhdGUpXG4gICAgICBzdWJzY3JpYmVyLnVwZGF0ZXIoKVxuICAgICAgc3Vic2NyaWJlci5pc05lZWRSZW5kZXIgPSBmYWxzZVxuICAgIH0pXG4gIH1cblxuICBzZXRTdGF0ZShuZXdTdGF0ZTogYW55KTogdm9pZCB7XG4gICAgdGhpcy5jaGVja1VwZGF0YVN0YXRlKG5ld1N0YXRlKVxuXG4gICAgaWYgKCF0aGlzLmlzTmVlZFVwZGF0ZSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy5yZWZsZWN0TmVlZFJlbmRlcihuZXdTdGF0ZSlcbiAgICB0aGlzLnJlZmxlY3RTdGF0ZShuZXdTdGF0ZSlcbiAgICB0aGlzLm5vdGlmeShuZXdTdGF0ZSlcblxuICAgIHNldEl0ZW0oJ3NlYXJjaFN0YXRlJywgdGhpcy5pbml0YWxTdGF0ZSlcbiAgfVxuXG4gIGNoZWNrVXBkYXRhU3RhdGUobmV3U3RhdGU6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IEpTT04uc3RyaW5naWZ5KHsgLi4udGhpcy5pbml0YWxTdGF0ZSB9KVxuICAgIGNvbnN0IG5leHRTdGF0ZSA9IEpTT04uc3RyaW5naWZ5KHsgLi4udGhpcy5pbml0YWxTdGF0ZSwgLi4ubmV3U3RhdGUgfSlcblxuICAgIHRoaXMuaXNOZWVkVXBkYXRlID0gY3VycmVudFN0YXRlICE9PSBuZXh0U3RhdGVcbiAgfVxuXG4gIHJlZmxlY3ROZWVkUmVuZGVyKG5ld1N0YXRlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCB1cGRhdGVkU3RhdGVLZXlzID0gT2JqZWN0LmtleXMobmV3U3RhdGUpXG4gICAgY29uc3QgcmVuZGVyU3RhdGVLZXkgPSBBcnJheS5mcm9tKHRoaXMucmVuZGVyU3RhdGVLZXkpXG5cbiAgICBjb25zdCBzdGF0ZSA9IHVwZGF0ZWRTdGF0ZUtleXMuZmlsdGVyKGtleSA9PiByZW5kZXJTdGF0ZUtleS5pbmNsdWRlcyhrZXkpKVxuICAgIHRoaXMuaXNOZWVkUmVuZGVyID0gc3RhdGUubGVuZ3RoID09PSAwXG4gIH1cblxuICByZWZsZWN0U3RhdGUobmV3U3RhdGU6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IHVwZGF0ZWRTdGF0ZUtleXMgPSBPYmplY3Qua2V5cyhuZXdTdGF0ZSlcblxuICAgIHVwZGF0ZWRTdGF0ZUtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgY29uc3Qgc3RhdGVLZXkgPSBrZXkgYXMga2V5b2YgU3RhdGVUeXBlXG4gICAgICB0aGlzLmluaXRhbFN0YXRlW3N0YXRlS2V5XSA9IG5ld1N0YXRlW1xuICAgICAgICBzdGF0ZUtleVxuICAgICAgXSBhcyBTdGF0ZVR5cGVba2V5b2YgU3RhdGVUeXBlXVxuICAgIH0pXG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ29tcG9uZW50UHJvcHM8U3RhdGVUeXBlPiB7XG4gIG5vZGU6IEVsZW1lbnRcbiAgaW5pdGFsU3RhdGU6IFN0YXRlVHlwZSB8IG51bGxcbiAgcmVuZGVyU3RhdGVLZXk/OiBzdHJpbmdbXVxufVxuIiwiY29uc3Qgc2V0SXRlbSA9IChrZXk6IHN0cmluZywgdmFsdWU6IGFueSk6IHZvaWQgPT4ge1xuICB0cnkge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihg7KCA7J6l7J20IOuQmOyngCDslYrslZjsirXri4jri6QhYClcbiAgfVxufVxuXG5jb25zdCBnZXRJdGVtID0gKGtleTogc3RyaW5nKTogYW55ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSlcbiAgICByZXR1cm4gdmFsdWUgPyBKU09OLnBhcnNlKHZhbHVlKSA6IFtdXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGVycm9yKVxuICB9XG59XG5cbmV4cG9ydCB7IHNldEl0ZW0sIGdldEl0ZW0gfVxuIiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQgZGVmYXVsdCB7XCJTZWFyY2hJbnB1dF9faW5wdXRcIjpcIm9aRmRTOEFNalI1Uk1ZeUJOdktWXCJ9OyIsImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0Bjb21wb25lbnRzJ1xuaW1wb3J0IHN0eWxlcyBmcm9tICcuL1NlYXJjaElucHV0Lm1vZHVsZS5zY3NzJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWFyY2hJbnB1dCBleHRlbmRzIENvbXBvbmVudDxJU2VhcmNoSW5wdXRTdGF0ZT4ge1xuICBoYW5kbGVJbnB1dDogKGU6IGFueSkgPT4gdm9pZFxuICBoYW5kbGVGb2N1czogKCkgPT4gdm9pZFxuICB0ZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHsgU2VhcmNoSW5wdXRfX2lucHV0IH0gPSBzdHlsZXNcbiAgICBjb25zdCB7IGtleXdvcmQgfSA9IHRoaXMuaW5pdGFsU3RhdGVcblxuICAgIHJldHVybiBgXG4gICAgICA8aW5wdXQgY2xhc3M9JyR7U2VhcmNoSW5wdXRfX2lucHV0fScgdHlwZT0ndGV4dCcgcGxhY2Vob2xkZXI9J+ybue2IsOygnOuqqSwg7J6R6rCA7J2066aE7Jy866GcIOqygOyDiScgdmFsdWU9JyR7a2V5d29yZH0nLz5cbiAgICBgXG4gIH1cblxuICBzZXR1cCgpOiB2b2lkIHtcbiAgICBjb25zdCB7IG9uSW5wdXQgfSA9IHRoaXMuaW5pdGFsU3RhdGVcblxuICAgIHRoaXMuaGFuZGxlSW5wdXQgPSAoZSk6IHZvaWQgPT4ge1xuICAgICAgb25JbnB1dChlLnRhcmdldC52YWx1ZSlcbiAgICB9XG5cbiAgICB0aGlzLmhhbmRsZUZvY3VzID0gKCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3QgJGlucHV0ID0gdGhpcy5ub2RlIGFzIEhUTUxJbnB1dEVsZW1lbnRcbiAgICAgICRpbnB1dC5mb2N1cygpXG4gICAgfVxuICB9XG5cbiAgc2V0RXZlbnQoKTogdm9pZCB7XG4gICAgdGhpcy5ub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5oYW5kbGVJbnB1dClcbiAgICB0aGlzLmhhbmRsZUZvY3VzKClcbiAgfVxuXG4gIGNsZWFyRXZlbnQoKTogdm9pZCB7XG4gICAgdGhpcy5ub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5oYW5kbGVJbnB1dClcbiAgfVxufVxuXG5pbnRlcmZhY2UgSVNlYXJjaElucHV0U3RhdGUge1xuICBrZXl3b3JkOiBzdHJpbmdcbiAgb25JbnB1dD8oa2V5d29yZDogc3RyaW5nKTogdm9pZFxufVxuIiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQgZGVmYXVsdCB7XCJyZXN1bHRfbGlzdFwiOlwiaGpDZGNvMjdsSkpUbzJveVJONXdcIixcInNlbGVjdGVkXCI6XCJ5cUJxV3hpUjlBU3RHQjU4ckxmU1wiLFwibWF0Y2hlZFwiOlwiT0FmNUp3a0Q5b1NPSldwbFdLXzBcIn07IiwiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGNvbXBvbmVudHMnXG5pbXBvcnQgc3R5bGVzIGZyb20gJy4vU2VhcmNoUmVzdWx0Lm1vZHVsZS5zY3NzJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWFyY2hSZXN1bHQgZXh0ZW5kcyBDb21wb25lbnQ8SVNlYXJjaFJlc3VsdFN0YXRlPiB7XG4gIGhhbmRsZUNsaWNrOiAoc2VsZWN0ZWRJdGVtOiBhbnkpID0+IHZvaWRcbiAgdGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IHNlbGVjdGVkSW5kZXgsIGlzUmVzdWx0TGlzdFZpc2lhYmxlLCBsaXN0RGF0YSwga2V5d29yZCB9ID1cbiAgICAgIHRoaXMuaW5pdGFsU3RhdGVcbiAgICBjb25zdCB7IHJlc3VsdF9saXN0LCBzZWxlY3RlZCwgbWF0Y2hlZCB9ID0gc3R5bGVzXG5cbiAgICBjb25zdCBtYXRjaEtleXdvcmQgPSAoaXRlbTogYW55LCBrZXl3b3JkOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICAgICAgaWYgKCFpdGVtLmluY2x1ZGVzKGtleXdvcmQpKSB7XG4gICAgICAgIHJldHVybiBpdGVtXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1hdGNoVGV4dCA9IGl0ZW0ubWF0Y2gobmV3IFJlZ0V4cChrZXl3b3JkLCAnZ2knKSlbMF1cblxuICAgICAgcmV0dXJuIGl0ZW0ucmVwbGFjZShcbiAgICAgICAgbmV3IFJlZ0V4cChtYXRjaFRleHQsICdnaScpLFxuICAgICAgICBgPHNwYW4gY2xhc3M9JyR7bWF0Y2hlZH0nPiR7bWF0Y2hUZXh0fTwvc3Bhbj5gXG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuIGBcbiAgICAgIDx1bCBjbGFzcz0nJHtpc1Jlc3VsdExpc3RWaXNpYWJsZSA/IGAke3Jlc3VsdF9saXN0fWAgOiAnaGlkZSd9Jz5cbiAgICAgICR7QXJyYXkuZnJvbShsaXN0RGF0YSlcbiAgICAgICAgPy5tYXAoXG4gICAgICAgICAgKGl0ZW0sIGluZGV4KSA9PlxuICAgICAgICAgICAgYDxsaSBjbGFzcz0nJHtcbiAgICAgICAgICAgICAgaW5kZXggPT09IHNlbGVjdGVkSW5kZXggPyBgJHtzZWxlY3RlZH1gIDogJydcbiAgICAgICAgICAgIH0nIGRhdGEtaW5kZXg9JyR7aW5kZXh9Jz5cbiAgICAgICAgICAgICAgPHNwYW4+JHttYXRjaEtleXdvcmQoaXRlbS50aXRsZSwga2V5d29yZCl9PC9zcGFuPlxuICAgICAgICAgICAgICA8c3Bhbj5bICR7bWF0Y2hLZXl3b3JkKGl0ZW0uYXV0aG9yLCBrZXl3b3JkKX0gXSA8L3NwYW4+XG4gICAgICAgICAgICA8L2xpPmBcbiAgICAgICAgKVxuICAgICAgICAuam9pbignJyl9XG4gICAgICA8L3VsPlxuICAgIGBcbiAgfVxuXG4gIHNldHVwKCk6IHZvaWQge1xuICAgIGNvbnN0IHsgb25DbGljayB9ID0gdGhpcy5pbml0YWxTdGF0ZVxuXG4gICAgdGhpcy5oYW5kbGVDbGljayA9IChlKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudFxuICAgICAgY29uc3QgJGxpID0gdGFyZ2V0LmNsb3Nlc3QoJ2xpJylcbiAgICAgIGlmICgkbGkpIHtcbiAgICAgICAgY29uc3QgeyBpbmRleCB9ID0gJGxpLmRhdGFzZXRcbiAgICAgICAgb25DbGljayh0aGlzLmluaXRhbFN0YXRlLmxpc3REYXRhW3BhcnNlSW50KGluZGV4KV0sIGluZGV4KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50KCk6IHZvaWQge1xuICAgIHRoaXMubm9kZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlQ2xpY2spXG5cbiAgICBjb25zdCB7IHNlbGVjdGVkSW5kZXggfSA9IHRoaXMuaW5pdGFsU3RhdGVcblxuICAgIGNvbnN0IHRlbXAgPSA0MC41IC8vbGkgc2l6ZVxuICAgIGlmICgoc2VsZWN0ZWRJbmRleCA+IDAgJiYgc2VsZWN0ZWRJbmRleCA8PSAzKSB8fCBzZWxlY3RlZEluZGV4ID09PSAwKSB7XG4gICAgICB0aGlzLm5vZGUuc2Nyb2xsVG8oMCwgMClcbiAgICB9XG5cbiAgICBpZiAoc2VsZWN0ZWRJbmRleCA+IDMpIHtcbiAgICAgIHRoaXMubm9kZS5zY3JvbGxUbygwLCB0ZW1wICogKHNlbGVjdGVkSW5kZXggLSAzKSlcbiAgICB9XG4gIH1cblxuICBjbGVhckV2ZW50KCk6IHZvaWQge1xuICAgIHRoaXMubm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlQ2xpY2spXG4gIH1cbn1cblxuaW50ZXJmYWNlIElTZWFyY2hSZXN1bHRTdGF0ZSB7XG4gIGlzUmVzdWx0TGlzdFZpc2lhYmxlOiBib29sZWFuXG4gIHNlbGVjdGVkSW5kZXg6IG51bWJlclxuICBsaXN0RGF0YTogSUl0ZW1bXVxuICBrZXl3b3JkOiBzdHJpbmdcbiAgb25DbGljayhzZWxlY3RlZEl0ZW06IGFueSwgaW5kZXg6IHN0cmluZyk6IHZvaWRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJSXRlbSB7XG4gIHdlYnRvb25JZDogbnVtYmVyXG4gIHRpdGxlOiBzdHJpbmdcbiAgYXV0aG9yOiBzdHJpbmdcbiAgaW1nOiBzdHJpbmdcbiAgc2VydmljZTogc3RyaW5nXG4gIHVwZGF0ZURheXM6IHN0cmluZ1tdXG4gIHVybDogc3RyaW5nXG59XG4iLCJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAY29tcG9uZW50cydcbmltcG9ydCB0eXBlIHsgSUl0ZW0gfSBmcm9tICcuLi9TZWFyY2hSZXN1bHQnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlYXJjaEl0ZW1JbmZvIGV4dGVuZHMgQ29tcG9uZW50PElTZWFyY2hJdGVtSW5mb1N0YXRlPiB7XG4gIHRlbXBsYXRlKCk6IHN0cmluZyB7XG4gICAgY29uc3QgeyBpc01vZGFsVmlzaWFibGUsIHNlbGVjdGVkSXRlbSB9ID0gdGhpcy5pbml0YWxTdGF0ZVxuICAgIHJldHVybiBgXG4gICAgPGRpdj5cbiAgICAke1xuICAgICAgaXNNb2RhbFZpc2lhYmxlXG4gICAgICAgID8gYFxuICAgICAgPGRpdiBjbGFzcz0naXRlbV9pbmZvJyA+XG4gICAgICAgIDxkaXYgY2xhc3M9J21vZGFsJz5cbiAgICAgICAgICA8YnV0dG9uPlg8L2J1dHRvbj4gXG4gICAgICAgICAgPGEgaHJlZj0nJHtzZWxlY3RlZEl0ZW0udXJsfScgdGFyZ2V0PSdfYmxhbmsnPlxuICAgICAgICAgICAgPGltZyBzcmM9JyR7c2VsZWN0ZWRJdGVtLmltZ30nIC8+XG4gICAgICAgICAgPC9hPlxuICAgICAgICAgIDxwPuybue2IsCDsoJzrqqk6ICR7c2VsZWN0ZWRJdGVtLnRpdGxlfTwvcD5cbiAgICAgICAgICA8cD7snpHqsIA6ICR7c2VsZWN0ZWRJdGVtLmF1dGhvcn08L3A+XG4gICAgICAgICAgPHA+7Jew7J6sIOyCrOydtO2KuDogJHtzZWxlY3RlZEl0ZW0uc2VydmljZX08L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICBgXG4gICAgICAgIDogJydcbiAgICB9XG4gICAgPC9kaXY+XG4gICAgYFxuICB9XG59XG5cbmludGVyZmFjZSBJU2VhcmNoSXRlbUluZm9TdGF0ZSB7XG4gIHNlbGVjdGVkSXRlbTogSUl0ZW1cbiAgaXNNb2RhbFZpc2lhYmxlOiBib29sZWFuXG59XG4iLCIvLyBleHRyYWN0ZWQgYnkgbWluaS1jc3MtZXh0cmFjdC1wbHVnaW5cbmV4cG9ydCBkZWZhdWx0IHtcImVycm9yX21lZ1wiOlwibWF3TDVqWVBibG1YeGN3SjdmM1hcIixcInVwXCI6XCJFQTVLZllTSmxTQTVMamczV3luc1wifTsiLCJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAY29tcG9uZW50cydcbmltcG9ydCBzdHlsZXMgZnJvbSAnLi9FcnJvck1lZy5tb2R1bGUuc2NzcydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXJyb3JNZWcgZXh0ZW5kcyBDb21wb25lbnQ8SUVycm9yTWVnU3RhdGU+IHtcbiAgdGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IGlzRXJyb3JNZWcsIGtleXdvcmQgfSA9IHRoaXMuaW5pdGFsU3RhdGVcbiAgICBjb25zdCB7IGVycm9yX21lZyB9ID0gc3R5bGVzXG5cbiAgICBjb25zdCBrZXl3b3JkRXJyb3IgPSBgPHNwYW4+6rKA7IOJ7Ja066W8IOyeheugpe2VtOyjvOyEuOyalCA6KTwvc3Bhbj5gXG4gICAgY29uc3QgbGVuZ3RoRXJyb3IgPSBgPHNwYW4+PHN0cm9uZz4n65GQIOq4gOyekCc8L3N0cm9uZz4g67aA7YSwIOqygOyDieydtCDqsIDriqXtlanri4jri6QgOik8L3NwYW4+YFxuXG4gICAgcmV0dXJuIGBcbiAgICA8ZGl2IGNsYXNzPScke2Vycm9yX21lZ30nPlxuICAgICR7aXNFcnJvck1lZyA/IChrZXl3b3JkLmxlbmd0aCA9PT0gMCA/IGtleXdvcmRFcnJvciA6IGxlbmd0aEVycm9yKSA6ICcnfVxuICAgIDwvZGl2PlxuICAgIGBcbiAgfVxufVxuXG5pbnRlcmZhY2UgSUVycm9yTWVnU3RhdGUge1xuICBpc0Vycm9yTWVnOiBib29sZWFuXG4gIGtleXdvcmQ6IHN0cmluZ1xufVxuIiwiaW1wb3J0IHsgc2VsZWN0RWwgfSBmcm9tICdAdXRpbHMnXG5pbXBvcnQgQXBwIGZyb20gJ0FwcCdcbmltcG9ydCAnLi9zY3NzL2luZGV4LnNjc3MnXG5cbm5ldyBBcHAoeyBub2RlOiBzZWxlY3RFbChkb2N1bWVudCwgJyNyb290JyksIGluaXRhbFN0YXRlOiBudWxsIH0pXG4iLCJpbXBvcnQgeyBhcGkgfSBmcm9tICdAYXBpJ1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBTZWFyY2hJbnB1dCxcbiAgU2VhcmNoUmVzdWx0LFxuICBTZWFyY2hJdGVtSW5mbyxcbiAgRXJyb3JNZWdcbn0gZnJvbSAnQGNvbXBvbmVudHMnXG5pbXBvcnQgdHlwZSB7IElDb21wb25lbnRQcm9wcyB9IGZyb20gJ0Bjb21wb25lbnRzL2NvcmUvQ29tcG9uZW50J1xuaW1wb3J0IHR5cGUgeyBJSXRlbSB9IGZyb20gJ0Bjb21wb25lbnRzL3NlYXJjaC9TZWFyY2hSZXN1bHQnXG5pbXBvcnQgeyBkZWJvdW5jZSwgc2VsZWN0RWwsIGdldEl0ZW0gfSBmcm9tICdAdXRpbHMnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwcCBleHRlbmRzIENvbXBvbmVudDxJQXBwU3RhdGU+IHtcbiAgaGFuZGxlQ2hhbmdlOiAoa2V5d29yZDogc3RyaW5nKSA9PiB2b2lkXG4gIGhhbmRsZUtleUNoYW5nZTogKGU6IGFueSkgPT4gdm9pZFxuICBoYW5kbGVDbGljazogKGU6IGFueSkgPT4gdm9pZFxuICBjb25zdHJ1Y3Rvcih7IG5vZGUgfTogSUNvbXBvbmVudFByb3BzPElBcHBTdGF0ZT4pIHtcbiAgICBjb25zdCBpbml0YWxTdGF0ZSA9IHtcbiAgICAgIGtleXdvcmQ6ICcnLFxuICAgICAgc2VsZWN0ZWRJbmRleDogMCxcbiAgICAgIGxpc3REYXRhOiBbXSxcbiAgICAgIHNlbGVjdGVkSXRlbToge30sXG4gICAgICBpc1Jlc3VsdExpc3RWaXNpYWJsZTogZmFsc2UsXG4gICAgICBpc01vZGFsVmlzaWFibGU6IGZhbHNlLFxuICAgICAgaXNFcnJvck1lZzogdHJ1ZVxuICAgIH0gYXMgSUFwcFN0YXRlXG5cbiAgICBzdXBlcih7IG5vZGUsIGluaXRhbFN0YXRlIH0pXG4gIH1cblxuICBzZXR1cCgpOiB2b2lkIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgLi4udGhpcy5pbml0YWxTdGF0ZSwgLi4uZ2V0SXRlbSgnc2VhcmNoU3RhdGUnKSB9KVxuICAgIHRoaXMuaGFuZGxlQ2hhbmdlID0gZGVib3VuY2UoYXN5bmMgKGtleXdvcmQpOiBQcm9taXNlPGFueT4gPT4ge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1jb25mdXNpbmctdm9pZC1leHByZXNzaW9uXG4gICAgICBjb25zdCBsaXN0RGF0YSA9IGF3YWl0IGFwaS5nZXRXZWJUb29uTGlzdChrZXl3b3JkKVxuXG4gICAgICBpZiAoIWtleXdvcmQpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgaXNSZXN1bHRMaXN0VmlzaWFibGU6IGZhbHNlLFxuICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IDAsXG4gICAgICAgICAga2V5d29yZDogJycsXG4gICAgICAgICAgbGlzdERhdGE6ICFsaXN0RGF0YS5sZW5ndGggPyBbXSA6IGxpc3REYXRhLFxuICAgICAgICAgIHNlbGVjdGVkSXRlbToge31cbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSBpZiAoa2V5d29yZC5sZW5ndGggPCAyICYmIGtleXdvcmQubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBpc1Jlc3VsdExpc3RWaXNpYWJsZTogZmFsc2UsXG4gICAgICAgICAgaXNFcnJvck1lZzogdHJ1ZSxcbiAgICAgICAgICBrZXl3b3JkOiBrZXl3b3JkXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBpc1Jlc3VsdExpc3RWaXNpYWJsZTogbGlzdERhdGEubGVuZ3RoID4gMCxcbiAgICAgICAgICBsaXN0RGF0YTogbGlzdERhdGEsXG4gICAgICAgICAga2V5d29yZDoga2V5d29yZCxcbiAgICAgICAgICBpc0Vycm9yTWVnOiBmYWxzZVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sIDMwMClcblxuICAgIHRoaXMuaGFuZGxlS2V5Q2hhbmdlID0gKGUpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IHsgbGlzdERhdGEsIHNlbGVjdGVkSW5kZXggfSA9IHRoaXMuaW5pdGFsU3RhdGVcblxuICAgICAgY29uc3QgQUNUSU9OS0VZUyA9IHtcbiAgICAgICAgQVJST1dVUDogJ0Fycm93VXAnLFxuICAgICAgICBBUlJPV0RPV046ICdBcnJvd0Rvd24nLFxuICAgICAgICBFTlRFUjogJ0VudGVyJyxcbiAgICAgICAgRVNDQVBFOiAnRXNjYXBlJ1xuICAgICAgfVxuXG4gICAgICBpZiAoT2JqZWN0LnZhbHVlcyhBQ1RJT05LRVlTKS5pbmNsdWRlcyhlLmtleSkgJiYgIWxpc3REYXRhLmxlbmd0aCkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgY29uc3QgbGFzdEluZGV4ID0gbGlzdERhdGEubGVuZ3RoIC0gMVxuICAgICAgbGV0IG5leHRJbmRleCA9IHNlbGVjdGVkSW5kZXhcblxuICAgICAgc3dpdGNoIChlLmtleSkge1xuICAgICAgICBjYXNlIEFDVElPTktFWVMuQVJST1dVUDpcbiAgICAgICAgICBuZXh0SW5kZXggPSBzZWxlY3RlZEluZGV4ID09PSAwID8gbGFzdEluZGV4IDogbmV4dEluZGV4IC0gMVxuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogbmV4dEluZGV4XG4gICAgICAgICAgfSlcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIEFDVElPTktFWVMuQVJST1dET1dOOlxuICAgICAgICAgIG5leHRJbmRleCA9IHNlbGVjdGVkSW5kZXggPT09IGxhc3RJbmRleCA/IDAgOiBuZXh0SW5kZXggKyAxXG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzZWxlY3RlZEluZGV4OiBuZXh0SW5kZXhcbiAgICAgICAgICB9KVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgQUNUSU9OS0VZUy5FTlRFUjpcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHNlbGVjdGVkSXRlbTogbGlzdERhdGFbc2VsZWN0ZWRJbmRleF0sXG4gICAgICAgICAgICBpc01vZGFsVmlzaWFibGU6IHRydWVcbiAgICAgICAgICB9KVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgQUNUSU9OS0VZUy5FU0NBUEU6XG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBpc01vZGFsVmlzaWFibGU6IGZhbHNlXG4gICAgICAgICAgfSlcbiAgICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaGFuZGxlQ2xpY2sgPSAoZSk6IHZvaWQgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCdidXR0b24nKSB8fFxuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2l0ZW1faW5mbycpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgaXNNb2RhbFZpc2lhYmxlOiBmYWxzZVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRlbXBsYXRlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBcbiAgICAgIDxtYWluIGlkPSdyb290Jz5cbiAgICAgICAgPGhlYWRlciBjbGFzcz0naGVhZGVyJz5XZWJ0b29ucyBTZWFyY2g8L2hlYWRlcj5cbiAgICAgICAgPGRpdiBjbGFzcz0nY29udGFpbmVyJz5cbiAgICAgICAgICA8U2VhcmNoSW5wdXQ+PC9TZWFyY2hJbnB1dD5cbiAgICAgICAgICA8RXJyb3JNZXNzYWdlPjwvRXJyb3JNZXNzYWdlPlxuICAgICAgICAgIDxTZWFyY2hSZXN1bHRMaXN0PjwvU2VhcmNoUmVzdWx0TGlzdD5cbiAgICAgICAgICA8U2VhcmNoSXRlbUluZm8+PC9TZWFyY2hJdGVtSW5mbz5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L21haW4+XG4gIGBcbiAgfVxuXG4gIHJlbmRlckNoaWxkQ29tcG9uZW50KCk6IHZvaWQge1xuICAgIGNvbnN0IHtcbiAgICAgIGtleXdvcmQsXG4gICAgICBzZWxlY3RlZEluZGV4LFxuICAgICAgbGlzdERhdGEsXG4gICAgICBpc1Jlc3VsdExpc3RWaXNpYWJsZSxcbiAgICAgIHNlbGVjdGVkSXRlbSxcbiAgICAgIGlzTW9kYWxWaXNpYWJsZSxcbiAgICAgIGlzRXJyb3JNZWdcbiAgICB9ID0gdGhpcy5pbml0YWxTdGF0ZVxuXG4gICAgbmV3IFNlYXJjaElucHV0KHtcbiAgICAgIG5vZGU6IHNlbGVjdEVsKHRoaXMubm9kZSwgJ1NlYXJjaElucHV0JyksXG4gICAgICBpbml0YWxTdGF0ZToge1xuICAgICAgICBrZXl3b3JkOiB0aGlzLmluaXRhbFN0YXRlLmtleXdvcmQsXG4gICAgICAgIG9uSW5wdXQ6IHRoaXMuaGFuZGxlQ2hhbmdlXG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IGVycm9yTWVnID0gbmV3IEVycm9yTWVnKHtcbiAgICAgIG5vZGU6IHNlbGVjdEVsKHRoaXMubm9kZSwgJ0Vycm9yTWVzc2FnZScpLFxuICAgICAgcmVuZGVyU3RhdGVLZXk6IFsnc2VsZWN0ZWRJdGVtJywgJ3NlbGVjdGVkSW5kZXgnXSxcbiAgICAgIGluaXRhbFN0YXRlOiB7IGlzRXJyb3JNZWcsIGtleXdvcmQgfVxuICAgIH0pXG5cbiAgICBjb25zdCBzZWFyY2hSZXN1bHQgPSBuZXcgU2VhcmNoUmVzdWx0KHtcbiAgICAgIG5vZGU6IHNlbGVjdEVsKHRoaXMubm9kZSwgJ1NlYXJjaFJlc3VsdExpc3QnKSxcbiAgICAgIGluaXRhbFN0YXRlOiB7XG4gICAgICAgIGtleXdvcmQsXG4gICAgICAgIGxpc3REYXRhLFxuICAgICAgICBpc1Jlc3VsdExpc3RWaXNpYWJsZSxcbiAgICAgICAgc2VsZWN0ZWRJbmRleCxcbiAgICAgICAgb25DbGljazogKHNlbGVjdGVkSXRlbTogYW55LCBpbmRleDogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW06IHNlbGVjdGVkSXRlbSxcbiAgICAgICAgICAgIGlzTW9kYWxWaXNpYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IE51bWJlcihpbmRleClcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IHNlYXJjaEl0ZW1JbmZvID0gbmV3IFNlYXJjaEl0ZW1JbmZvKHtcbiAgICAgIG5vZGU6IHNlbGVjdEVsKHRoaXMubm9kZSwgJ1NlYXJjaEl0ZW1JbmZvJyksXG4gICAgICBpbml0YWxTdGF0ZToge1xuICAgICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICAgIGlzTW9kYWxWaXNpYWJsZVxuICAgICAgfVxuICAgIH0pXG5cbiAgICB0aGlzLnN1YnNjcmliZShzZWFyY2hSZXN1bHQpXG4gICAgdGhpcy5zdWJzY3JpYmUoc2VhcmNoSXRlbUluZm8pXG4gICAgdGhpcy5zdWJzY3JpYmUoZXJyb3JNZWcpXG4gIH1cblxuICBzZXRFdmVudCgpOiB2b2lkIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmhhbmRsZUtleUNoYW5nZSlcbiAgICB0aGlzLm5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZUNsaWNrKVxuICB9XG5cbiAgY2xlYXJFdmVudCgpOiB2b2lkIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmhhbmRsZUtleUNoYW5nZSlcbiAgICB0aGlzLm5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZUNsaWNrKVxuICB9XG59XG5cbmludGVyZmFjZSBJQXBwU3RhdGUge1xuICBrZXl3b3JkOiBzdHJpbmdcbiAgc2VsZWN0ZWRJbmRleDogbnVtYmVyXG4gIGxpc3REYXRhOiBJSXRlbVtdXG4gIHNlbGVjdGVkSXRlbTogSUl0ZW1cbiAgaXNSZXN1bHRMaXN0VmlzaWFibGU6IGJvb2xlYW5cbiAgaXNNb2RhbFZpc2lhYmxlOiBib29sZWFuXG4gIGlzRXJyb3JNZWc6IGJvb2xlYW5cbn1cbiIsImNvbnN0IGRlYm91bmNlOiBJRGVib3VuY2UgPSAoY2FsbGJhY2ssIGRlbGF5KSA9PiB7XG4gIGxldCB0aW1lb3V0OiBudW1iZXJcblxuICByZXR1cm4gZXZlbnQgPT4ge1xuICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dClcbiAgICB9XG5cbiAgICB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIGRlbGF5LCBldmVudClcbiAgfVxufVxuXG5leHBvcnQgeyBkZWJvdW5jZSB9XG5cbnR5cGUgSURlYm91bmNlID0gKFxuICBjYWxsYmFjazogKGV2ZW50OiBhbnkpID0+IHZvaWQsXG4gIGRlbGF5OiBudW1iZXJcbikgPT4gKGV2ZW50OiBhbnkpID0+IHZvaWRcbiIsImltcG9ydCB7IEJBU0VfVVJMLCBSRVFVU0VUX01FU1NBR0UgfSBmcm9tICdAY29uc3RhbnRzJ1xuXG5jb25zdCByZXF1c2V0ID0gYXN5bmMgKHVybDogc3RyaW5nKTogUHJvbWlzZTxhbnk+ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybClcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoUkVRVVNFVF9NRVNTQUdFLkhUVFBfRVJST1IpXG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICByZXR1cm4gZGF0YS53ZWJ0b29uc1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYCR7UkVRVVNFVF9NRVNTQUdFLlNFUlZFUl9FUlJPUn0gJHtlcnJvci5tZXNzYWdlfWApXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGFwaSA9IHtcbiAgZ2V0V2ViVG9vbkxpc3Q6IGFzeW5jIChrZXl3b3JkOiBzdHJpbmcpOiBQcm9taXNlPGFueT4gPT5cbiAgICByZXF1c2V0KGAke0JBU0VfVVJMfS9zZWFyY2g/a2V5d29yZD0ke2tleXdvcmR9YClcbn1cbiIsImNvbnN0IEJBU0VfVVJMID0gJ2h0dHBzOi8va29yZWEtd2VidG9vbi1hcGkuaGVyb2t1YXBwLmNvbSdcbmNvbnN0IFJFUVVTRVRfTUVTU0FHRSA9IHtcbiAgSFRUUF9FUlJPUjogJ+yEnOuyhOyZgOydmCDsl7DqsrDsnbQg67aI7JWI7KCV7ZWp64uI64ukIScsXG4gIFNFUlZFUl9FUlJPUjogJ+yXkOufrOqwgCDrsJzsg53tlojsirXri4jri6QhJ1xufVxuZXhwb3J0IHsgQkFTRV9VUkwsIFJFUVVTRVRfTUVTU0FHRSB9XG4iXSwibmFtZXMiOlsic2VsZWN0RWwiLCJzY29wZSIsImRvY3VtZW50Iiwic2VsZWN0b3IiLCJxdWVyeVNlbGVjdG9yIiwiQ29udmVydFRlbXBsYXRlVG9Db21wb25lbnQiLCJvbGROb2RlIiwidGhpcyIsIm5vZGUiLCJjb21wb25lbnRDaGlsZHJlbiIsIkFycmF5IiwiZnJvbSIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsInRlbXBsYXRlIiwiYm9keSIsImNoaWxkcmVuIiwiY29tcG9uZW50IiwiRG9jdW1lbnRGcmFnbWVudCIsImFwcGVuZCIsImFmdGVyIiwibmV4dFNpYmxpbmciLCJvbGRDU1MiLCJjbGFzc0xpc3QiLCJ2YWx1ZSIsInRyaW0iLCJuZXdDU1MiLCJjc3NWYWx1ZSIsImNsYXNzTmFtZSIsInJlbW92ZSIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwiaW5pdGFsU3RhdGUiLCJyZW5kZXJTdGF0ZUtleSIsIlNldCIsInN1YnNjcmliZXJzIiwiaXNOZWVkUmVuZGVyIiwiaXNOZWVkVXBkYXRlIiwic2V0dXAiLCJyZW5kZXIiLCJ3aW5kb3ciLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjYWxsIiwic2V0RXZlbnQiLCJyZW5kZXJDaGlsZENvbXBvbmVudCIsInVwZGF0ZXIiLCJjbGVhckV2ZW50Iiwic3Vic2NyaWJlIiwiZm9yRWFjaCIsInN1YnNjcmliZXIiLCJhZGQiLCJub3RpZnkiLCJuZXdTdGF0ZSIsInNldFN0YXRlIiwiY2hlY2tVcGRhdGFTdGF0ZSIsInJlZmxlY3ROZWVkUmVuZGVyIiwicmVmbGVjdFN0YXRlIiwia2V5IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvciIsIkVycm9yIiwiY3VycmVudFN0YXRlIiwibmV4dFN0YXRlIiwidXBkYXRlZFN0YXRlS2V5cyIsIk9iamVjdCIsImtleXMiLCJzdGF0ZSIsImZpbHRlciIsImluY2x1ZGVzIiwibGVuZ3RoIiwic3RhdGVLZXkiLCJTZWFyY2hJbnB1dCIsIlNlYXJjaElucHV0X19pbnB1dCIsImtleXdvcmQiLCJvbklucHV0IiwiaGFuZGxlSW5wdXQiLCJlIiwidGFyZ2V0IiwiaGFuZGxlRm9jdXMiLCJmb2N1cyIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiU2VhcmNoUmVzdWx0Iiwic2VsZWN0ZWRJbmRleCIsImlzUmVzdWx0TGlzdFZpc2lhYmxlIiwibGlzdERhdGEiLCJyZXN1bHRfbGlzdCIsInNlbGVjdGVkIiwibWF0Y2hlZCIsIm1hdGNoS2V5d29yZCIsIml0ZW0iLCJtYXRjaFRleHQiLCJtYXRjaCIsIlJlZ0V4cCIsInJlcGxhY2UiLCJtYXAiLCJpbmRleCIsInRpdGxlIiwiYXV0aG9yIiwiam9pbiIsIm9uQ2xpY2siLCJoYW5kbGVDbGljayIsIiRsaSIsImNsb3Nlc3QiLCJkYXRhc2V0IiwicGFyc2VJbnQiLCJzY3JvbGxUbyIsIlNlYXJjaEl0ZW1JbmZvIiwiaXNNb2RhbFZpc2lhYmxlIiwic2VsZWN0ZWRJdGVtIiwidXJsIiwiaW1nIiwic2VydmljZSIsIkVycm9yTWVnIiwiaXNFcnJvck1lZyIsImVycm9yX21lZyIsInN1cGVyIiwiZ2V0SXRlbSIsInBhcnNlIiwiaGFuZGxlQ2hhbmdlIiwiY2FsbGJhY2siLCJkZWxheSIsInRpbWVvdXQiLCJldmVudCIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJkZWJvdW5jZSIsInJlc3BvbnNlIiwiZmV0Y2giLCJvayIsImpzb24iLCJ3ZWJ0b29ucyIsImNvbnNvbGUiLCJtZXNzYWdlIiwiYXBpIiwiaGFuZGxlS2V5Q2hhbmdlIiwiQUNUSU9OS0VZUyIsIkFSUk9XVVAiLCJBUlJPV0RPV04iLCJFTlRFUiIsIkVTQ0FQRSIsInZhbHVlcyIsImxhc3RJbmRleCIsIm5leHRJbmRleCIsInByZXZlbnREZWZhdWx0IiwiY29udGFpbnMiLCJlcnJvck1lZyIsInNlYXJjaFJlc3VsdCIsIk51bWJlciIsInNlYXJjaEl0ZW1JbmZvIl0sInNvdXJjZVJvb3QiOiIifQ==