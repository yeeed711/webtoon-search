(()=>{"use strict";(()=>{const e=(e=document,t)=>e.querySelector(t);function t(){const e=this.node,t=Array.from((new DOMParser).parseFromString(this.template(),"text/html").body.children),s=new DocumentFragment;s.append(...t),e.after(s),this.node=e.nextSibling;const n=e.classList.value.trim(),i=this.node.classList.value.trim(),a=n!==i&&i||n;a?(this.node.className=a,e.remove()):e.remove()}var s=function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{o(n.next(e))}catch(e){a(e)}}function l(e){try{o(n.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,l)}o((n=n.apply(e,t||[])).next())}))};class n{constructor({node:e,initalState:t,renderStateKey:s=[]}){this.node=e,this.initalState=t,this.renderStateKey=new Set(s),this.subscribers=new Set([]),this.isNeedRender=!1,this.isNeedUpdate=!1,this.setup(),this.render()}setup(){}render(){window.requestAnimationFrame((()=>{t.call(this),this.setEvent(),this.renderChildComponent()}))}updater(){this.isNeedRender?(this.clearEvent(),this.render()):this.renderChildComponent()}renderChildComponent(){}setEvent(){}clearEvent(){}template(){return""}subscribe(...e){e.forEach((e=>{this.subscribers.add(e)}))}notify(e){Array.from(this.subscribers).forEach((t=>{t.setState(e),t.updater(),t.isNeedRender=!1}))}setState(e){this.checkUpdataState(e),this.isNeedUpdate&&(this.reflectNeedRender(e),this.reflectState(e),this.notify(e),((e,t)=>{try{localStorage.setItem("searchState",JSON.stringify(t))}catch(e){throw new Error("저장이 되지 않았습니다!")}})(0,this.initalState))}checkUpdataState(e){const t=JSON.stringify(Object.assign({},this.initalState)),s=JSON.stringify(Object.assign(Object.assign({},this.initalState),e));this.isNeedUpdate=t!==s}reflectNeedRender(e){const t=Object.keys(e),s=Array.from(this.renderStateKey),n=t.filter((e=>s.includes(e)));this.isNeedRender=0===n.length}reflectState(e){Object.keys(e).forEach((t=>{const s=t;this.initalState[s]=e[s]}))}}const i={SearchInput__input:"oZFdS8AMjR5RMYyBNvKV"};class a extends n{template(){const{SearchInput__input:e}=i,{keyword:t}=this.initalState;return`\n      <input class='${e}' type='text' placeholder='웹툰제목, 작가이름으로 검색' value='${t}'/>\n    `}setup(){const{onInput:e}=this.initalState;this.handleInput=t=>{e(t.target.value)},this.handleFocus=()=>{this.node.focus()}}setEvent(){this.node.addEventListener("input",this.handleInput),this.handleFocus()}clearEvent(){this.node.removeEventListener("input",this.handleInput)}}const r={result_list:"hjCdco27lJJTo2oyRN5w",selected:"yqBqWxiR9AStGB58rLfS",matched:"OAf5JwkD9oSOJWplWK_0"};class l extends n{template(){var e;const{selectedIndex:t,isResultListVisiable:s,listData:n,keyword:i}=this.initalState,{result_list:a,selected:l,matched:o}=r,c=(e,t)=>{if(!e.includes(t))return e;const s=e.match(new RegExp(t,"gi"))[0];return e.replace(new RegExp(s,"gi"),`<span class='${o}'>${s}</span>`)};return`\n      <ul class='${s?`${a}`:"hide"}'>\n      ${null===(e=Array.from(n))||void 0===e?void 0:e.map(((e,s)=>`<li class='${s===t?`${l}`:""}' data-index='${s}'>\n              <span>${c(e.title,i)}</span>\n              <span>[ ${c(e.author,i)} ] </span>\n            </li>`)).join("")}\n      </ul>\n    `}setup(){const{onClick:e}=this.initalState;this.handleClick=t=>{const s=t.target.closest("li");if(s){const{index:t}=s.dataset;e(this.initalState.listData[parseInt(t)],t)}}}setEvent(){this.node.addEventListener("click",this.handleClick);const{selectedIndex:e}=this.initalState;(e>0&&e<=3||0===e)&&this.node.scrollTo(0,0),e>3&&this.node.scrollTo(0,40.5*(e-3))}clearEvent(){this.node.removeEventListener("click",this.handleClick)}}class o extends n{template(){const{isModalVisiable:e,selectedItem:t}=this.initalState;return`\n    <div>\n    ${e?`\n      <div class='item_info' >\n        <div class='modal'>\n          <button>X</button> \n          <a href='${t.url}' target='_blank'>\n            <img src='${t.img}' />\n          </a>\n          <p>웹툰 제목: ${t.title}</p>\n          <p>작가: ${t.author}</p>\n          <p>연재 사이트: ${t.service}</p>\n        </div>\n      </div>\n      `:""}\n    </div>\n    `}}const c={error_meg:"mawL5jYPblmXxcwJ7f3X",up:"EA5KfYSJlSA5Ljg3Wyns"};class d extends n{template(){const{isErrorMeg:e,keyword:t,isResultListVisiable:s}=this.initalState,{error_meg:n}=c,i=`<span><strong>'${t}'</strong> 의 검색 결과가 없습니다 :<</span>`;return`\n    <div class='${n}'>\n    ${e?0===t.length?"<span>검색어를 입력해주세요 :)</span>":t.length<2&&t.length>0?"<span><strong>'두 글자'</strong> 부터 검색이 가능합니다 :)</span>":!s&&t.length>=2?i:void 0:""}\n    </div>\n    `}}new class extends n{constructor({node:e}){super({node:e,initalState:{keyword:"",selectedIndex:0,listData:[],selectedItem:{},isResultListVisiable:!1,isModalVisiable:!1,isErrorMeg:!0}})}setup(){this.setState(Object.assign(Object.assign({},this.initalState),(e=>{try{const e=localStorage.getItem("searchState");return e?JSON.parse(e):[]}catch(e){throw new Error(e)}})())),this.handleChange=((e,t)=>{let s;return t=>{s&&clearTimeout(s),s=window.setTimeout(e,200,t)}})((e=>{return t=this,n=void 0,a=function*(){const t=yield(e=>s(void 0,void 0,void 0,(function*(){return t=`https://korea-webtoon-api.herokuapp.com/search?keyword=${e}`,s(void 0,void 0,void 0,(function*(){try{const e=yield fetch(t);if(!e.ok)throw new Error("서버와의 연결이 불안정합니다!");return(yield e.json()).webtoons}catch(e){console.error(`에러가 발생했습니다! ${e.message}`)}}));var t})))(e);e?this.setState({isResultListVisiable:t.length>0,listData:t,keyword:e,isErrorMeg:!(t.length>0)}):this.setState({isResultListVisiable:!1,selectedIndex:0,keyword:"",listData:t.length?t:[],selectedItem:{}})},new((i=void 0)||(i=Promise))((function(e,s){function r(e){try{o(a.next(e))}catch(e){s(e)}}function l(e){try{o(a.throw(e))}catch(e){s(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,l)}o((a=a.apply(t,n||[])).next())}));var t,n,i,a})),this.handleKeyChange=e=>{const{listData:t,selectedIndex:s}=this.initalState,n={ARROWUP:"ArrowUp",ARROWDOWN:"ArrowDown",ENTER:"Enter",ESCAPE:"Escape"};if(Object.values(n).includes(e.key)&&!t.length)return;const i=t.length-1;let a=s;switch(e.key){case n.ARROWUP:a=0===s?i:a-1,this.setState({selectedIndex:a});break;case n.ARROWDOWN:a=s===i?0:a+1,this.setState({selectedIndex:a});break;case n.ENTER:e.preventDefault(),this.setState({selectedItem:t[s],isModalVisiable:!0});break;case n.ESCAPE:this.setState({isModalVisiable:!1})}},this.handleClick=e=>{(e.target.closest("button")||e.target.classList.contains("item_info"))&&this.setState({isModalVisiable:!1})}}template(){return"\n      <main id='root'>\n        <header class='header'>Webtoons Search</header>\n        <div class='container'>\n          <SearchInput></SearchInput>\n          <ErrorMessage></ErrorMessage>\n          <SearchResultList></SearchResultList>\n          <SearchItemInfo></SearchItemInfo>\n        </div>\n      </main>\n  "}renderChildComponent(){const{keyword:t,selectedIndex:s,listData:n,isResultListVisiable:i,selectedItem:r,isModalVisiable:c,isErrorMeg:h}=this.initalState;new a({node:e(this.node,"SearchInput"),initalState:{keyword:this.initalState.keyword,onInput:this.handleChange}});const u=new d({node:e(this.node,"ErrorMessage"),renderStateKey:["selectedItem","selectedIndex"],initalState:{isErrorMeg:h,keyword:t,isResultListVisiable:i}}),p=new l({node:e(this.node,"SearchResultList"),initalState:{keyword:t,listData:n,isResultListVisiable:i,selectedIndex:s,onClick:(e,t)=>{this.setState({selectedItem:e,isModalVisiable:!0,selectedIndex:Number(t)})}}}),S=new o({node:e(this.node,"SearchItemInfo"),initalState:{selectedItem:r,isModalVisiable:c}});this.subscribe(p),this.subscribe(S),this.subscribe(u)}setEvent(){window.addEventListener("keyup",this.handleKeyChange),this.node.addEventListener("click",this.handleClick)}clearEvent(){window.removeEventListener("keyup",this.handleKeyChange),this.node.removeEventListener("click",this.handleClick)}}({node:e(document,"#root"),initalState:null})})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLNEUsb0JBQW9CLFFBQVM3RSxLQUFLaUcsWUFDOUMsR0R2TE0sQ0FBRWhHLEtBQU1SLEVBQVNFLFNBQVUsU0FBVThCLFlBQWEsTSIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy91dGlscy9kb20vaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvY29yZS9Db21wb25lbnQudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL3V0aWxzL3N0b3JhZ2UvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvc2VhcmNoL1NlYXJjaElucHV0L1NlYXJjaElucHV0Lm1vZHVsZS5zY3NzPzE0NzEiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvc2VhcmNoL1NlYXJjaElucHV0L2luZGV4LnRzIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy9jb21wb25lbnRzL3NlYXJjaC9TZWFyY2hSZXN1bHQvU2VhcmNoUmVzdWx0Lm1vZHVsZS5zY3NzPzFhYjkiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvc2VhcmNoL1NlYXJjaFJlc3VsdC9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9zZWFyY2gvU2VhcmNoSXRlbUluZm8vaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvbWVzc2FnZS9FcnJvck1lZy9FcnJvck1lZy5tb2R1bGUuc2Nzcz8wYTNmIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy9jb21wb25lbnRzL21lc3NhZ2UvRXJyb3JNZWcvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL21haW4udHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL0FwcC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvdXRpbHMvaGVscGVycy9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvYXBpL2luZGV4LnRzIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy9jb25zdGFudHMvYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNlbGVjdEVsID0gKFxuICBzY29wZTogRWxlbWVudCB8IERvY3VtZW50ID0gZG9jdW1lbnQsXG4gIHNlbGVjdG9yOiBzdHJpbmdcbik6IEVsZW1lbnQgPT4ge1xuICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvcihzZWxlY3Rvcilcbn1cblxuY29uc3Qgc2VsZWN0QWxsID0gKHsgc2NvcGUsIHNlbGVjdG9yIH06IElTZWxlY3RUeXBlKTogRWxlbWVudFtdID0+IHtcbiAgcmV0dXJuIEFycmF5LmZyb20oc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpXG59XG5cbmNvbnN0IGNyZWF0ZUVsID0gKHRhZ05hbWU6IHN0cmluZyk6IEVsZW1lbnQgPT4ge1xuICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKVxufVxuXG5mdW5jdGlvbiBDb252ZXJ0VGVtcGxhdGVUb0NvbXBvbmVudCh0aGlzOiBhbnkpOiB2b2lkIHtcbiAgY29uc3Qgb2xkTm9kZSA9IHRoaXMubm9kZVxuICBjb25zdCBjb21wb25lbnRDaGlsZHJlbiA9IEFycmF5LmZyb20oXG4gICAgbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyh0aGlzLnRlbXBsYXRlKCksICd0ZXh0L2h0bWwnKS5ib2R5LmNoaWxkcmVuXG4gIClcbiAgY29uc3QgY29tcG9uZW50ID0gbmV3IERvY3VtZW50RnJhZ21lbnQoKVxuICBjb21wb25lbnQuYXBwZW5kKC4uLmNvbXBvbmVudENoaWxkcmVuKVxuXG4gIG9sZE5vZGUuYWZ0ZXIoY29tcG9uZW50KVxuICB0aGlzLm5vZGUgPSBvbGROb2RlLm5leHRTaWJsaW5nXG5cbiAgY29uc3Qgb2xkQ1NTID0gb2xkTm9kZS5jbGFzc0xpc3QudmFsdWUudHJpbSgpXG4gIGNvbnN0IG5ld0NTUyA9IHRoaXMubm9kZS5jbGFzc0xpc3QudmFsdWUudHJpbSgpXG4gIGNvbnN0IGlzQ2hhbmdlZENTUyA9IG9sZENTUyAhPT0gbmV3Q1NTXG4gIGNvbnN0IGNzc1ZhbHVlID0gaXNDaGFuZ2VkQ1NTID8gbmV3Q1NTIHx8IG9sZENTUyA6IG9sZENTU1xuXG4gIGlmICghY3NzVmFsdWUpIHtcbiAgICBvbGROb2RlLnJlbW92ZSgpXG4gICAgcmV0dXJuXG4gIH1cblxuICB0aGlzLm5vZGUuY2xhc3NOYW1lID0gY3NzVmFsdWVcblxuICBvbGROb2RlLnJlbW92ZSgpXG59XG5cbmV4cG9ydCB7IGNyZWF0ZUVsLCBzZWxlY3RFbCwgc2VsZWN0QWxsLCBDb252ZXJ0VGVtcGxhdGVUb0NvbXBvbmVudCB9XG5cbmludGVyZmFjZSBJU2VsZWN0VHlwZSB7XG4gIHNjb3BlOiBFbGVtZW50IHwgRG9jdW1lbnRcbiAgc2VsZWN0b3I6IHN0cmluZ1xufVxuIiwiaW1wb3J0IHsgQ29udmVydFRlbXBsYXRlVG9Db21wb25lbnQsIHNldEl0ZW0gfSBmcm9tICdAdXRpbHMnXG5cbmV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIENvbXBvbmVudDxTdGF0ZVR5cGU+IHtcbiAgbm9kZTogRWxlbWVudFxuICBpbml0YWxTdGF0ZTogU3RhdGVUeXBlXG4gIHJlbmRlclN0YXRlS2V5OiBTZXQ8c3RyaW5nPlxuICBzdWJzY3JpYmVyczogU2V0PGFueT5cbiAgaXNOZWVkUmVuZGVyOiBib29sZWFuXG4gIGlzTmVlZFVwZGF0ZTogYm9vbGVhblxuICBjb25zdHJ1Y3Rvcih7XG4gICAgbm9kZSxcbiAgICBpbml0YWxTdGF0ZSxcbiAgICByZW5kZXJTdGF0ZUtleSA9IFtdXG4gIH06IElDb21wb25lbnRQcm9wczxTdGF0ZVR5cGU+KSB7XG4gICAgdGhpcy5ub2RlID0gbm9kZVxuICAgIHRoaXMuaW5pdGFsU3RhdGUgPSBpbml0YWxTdGF0ZVxuICAgIHRoaXMucmVuZGVyU3RhdGVLZXkgPSBuZXcgU2V0KHJlbmRlclN0YXRlS2V5KVxuICAgIHRoaXMuc3Vic2NyaWJlcnMgPSBuZXcgU2V0KFtdKVxuICAgIHRoaXMuaXNOZWVkUmVuZGVyID0gZmFsc2VcbiAgICB0aGlzLmlzTmVlZFVwZGF0ZSA9IGZhbHNlXG5cbiAgICB0aGlzLnNldHVwKClcbiAgICB0aGlzLnJlbmRlcigpXG4gIH1cblxuICBzZXR1cCgpOiB2b2lkIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIHJlbmRlcigpOiB2b2lkIHtcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgIENvbnZlcnRUZW1wbGF0ZVRvQ29tcG9uZW50LmNhbGwodGhpcylcbiAgICAgIHRoaXMuc2V0RXZlbnQoKVxuICAgICAgdGhpcy5yZW5kZXJDaGlsZENvbXBvbmVudCgpXG4gICAgfSlcbiAgfVxuXG4gIHVwZGF0ZXIoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzTmVlZFJlbmRlcikge1xuICAgICAgdGhpcy5yZW5kZXJDaGlsZENvbXBvbmVudCgpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0aGlzLmNsZWFyRXZlbnQoKVxuICAgIHRoaXMucmVuZGVyKClcbiAgfVxuXG4gIHJlbmRlckNoaWxkQ29tcG9uZW50KCk6IHZvaWQge1xuICAgIHJldHVyblxuICB9XG5cbiAgc2V0RXZlbnQoKTogdm9pZCB7XG4gICAgcmV0dXJuXG4gIH1cblxuICBjbGVhckV2ZW50KCk6IHZvaWQge1xuICAgIHJldHVyblxuICB9XG5cbiAgdGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gJydcbiAgfVxuXG4gIHN1YnNjcmliZSguLi5zdWJzY3JpYmVyczogYW55W10pOiB2b2lkIHtcbiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKHN1YnNjcmliZXIgPT4ge1xuICAgICAgdGhpcy5zdWJzY3JpYmVycy5hZGQoc3Vic2NyaWJlcilcbiAgICB9KVxuICB9XG5cbiAgbm90aWZ5KG5ld1N0YXRlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBzdWJzY3JpYmVycyA9IEFycmF5LmZyb20odGhpcy5zdWJzY3JpYmVycylcblxuICAgIHN1YnNjcmliZXJzLmZvckVhY2goc3Vic2NyaWJlciA9PiB7XG4gICAgICBzdWJzY3JpYmVyLnNldFN0YXRlKG5ld1N0YXRlKVxuICAgICAgc3Vic2NyaWJlci51cGRhdGVyKClcbiAgICAgIHN1YnNjcmliZXIuaXNOZWVkUmVuZGVyID0gZmFsc2VcbiAgICB9KVxuICB9XG5cbiAgc2V0U3RhdGUobmV3U3RhdGU6IGFueSk6IHZvaWQge1xuICAgIHRoaXMuY2hlY2tVcGRhdGFTdGF0ZShuZXdTdGF0ZSlcblxuICAgIGlmICghdGhpcy5pc05lZWRVcGRhdGUpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMucmVmbGVjdE5lZWRSZW5kZXIobmV3U3RhdGUpXG4gICAgdGhpcy5yZWZsZWN0U3RhdGUobmV3U3RhdGUpXG4gICAgdGhpcy5ub3RpZnkobmV3U3RhdGUpXG5cbiAgICBzZXRJdGVtKCdzZWFyY2hTdGF0ZScsIHRoaXMuaW5pdGFsU3RhdGUpXG4gIH1cblxuICBjaGVja1VwZGF0YVN0YXRlKG5ld1N0YXRlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBjdXJyZW50U3RhdGUgPSBKU09OLnN0cmluZ2lmeSh7IC4uLnRoaXMuaW5pdGFsU3RhdGUgfSlcbiAgICBjb25zdCBuZXh0U3RhdGUgPSBKU09OLnN0cmluZ2lmeSh7IC4uLnRoaXMuaW5pdGFsU3RhdGUsIC4uLm5ld1N0YXRlIH0pXG5cbiAgICB0aGlzLmlzTmVlZFVwZGF0ZSA9IGN1cnJlbnRTdGF0ZSAhPT0gbmV4dFN0YXRlXG4gIH1cblxuICByZWZsZWN0TmVlZFJlbmRlcihuZXdTdGF0ZTogYW55KTogdm9pZCB7XG4gICAgY29uc3QgdXBkYXRlZFN0YXRlS2V5cyA9IE9iamVjdC5rZXlzKG5ld1N0YXRlKVxuICAgIGNvbnN0IHJlbmRlclN0YXRlS2V5ID0gQXJyYXkuZnJvbSh0aGlzLnJlbmRlclN0YXRlS2V5KVxuXG4gICAgY29uc3Qgc3RhdGUgPSB1cGRhdGVkU3RhdGVLZXlzLmZpbHRlcihrZXkgPT4gcmVuZGVyU3RhdGVLZXkuaW5jbHVkZXMoa2V5KSlcbiAgICB0aGlzLmlzTmVlZFJlbmRlciA9IHN0YXRlLmxlbmd0aCA9PT0gMFxuICB9XG5cbiAgcmVmbGVjdFN0YXRlKG5ld1N0YXRlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCB1cGRhdGVkU3RhdGVLZXlzID0gT2JqZWN0LmtleXMobmV3U3RhdGUpXG5cbiAgICB1cGRhdGVkU3RhdGVLZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlS2V5ID0ga2V5IGFzIGtleW9mIFN0YXRlVHlwZVxuICAgICAgdGhpcy5pbml0YWxTdGF0ZVtzdGF0ZUtleV0gPSBuZXdTdGF0ZVtcbiAgICAgICAgc3RhdGVLZXlcbiAgICAgIF0gYXMgU3RhdGVUeXBlW2tleW9mIFN0YXRlVHlwZV1cbiAgICB9KVxuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbXBvbmVudFByb3BzPFN0YXRlVHlwZT4ge1xuICBub2RlOiBFbGVtZW50XG4gIGluaXRhbFN0YXRlOiBTdGF0ZVR5cGUgfCBudWxsXG4gIHJlbmRlclN0YXRlS2V5Pzogc3RyaW5nW11cbn1cbiIsImNvbnN0IHNldEl0ZW0gPSAoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB2b2lkID0+IHtcbiAgdHJ5IHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYOyggOyepeydtCDrkJjsp4Ag7JWK7JWY7Iq164uI64ukIWApXG4gIH1cbn1cblxuY29uc3QgZ2V0SXRlbSA9IChrZXk6IHN0cmluZyk6IGFueSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdmFsdWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpXG4gICAgcmV0dXJuIHZhbHVlID8gSlNPTi5wYXJzZSh2YWx1ZSkgOiBbXVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihlcnJvcilcbiAgfVxufVxuXG5leHBvcnQgeyBzZXRJdGVtLCBnZXRJdGVtIH1cbiIsIi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpblxuZXhwb3J0IGRlZmF1bHQge1wiU2VhcmNoSW5wdXRfX2lucHV0XCI6XCJvWkZkUzhBTWpSNVJNWXlCTnZLVlwifTsiLCJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAY29tcG9uZW50cydcbmltcG9ydCBzdHlsZXMgZnJvbSAnLi9TZWFyY2hJbnB1dC5tb2R1bGUuc2NzcydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VhcmNoSW5wdXQgZXh0ZW5kcyBDb21wb25lbnQ8SVNlYXJjaElucHV0U3RhdGU+IHtcbiAgaGFuZGxlSW5wdXQ6IChlOiBhbnkpID0+IHZvaWRcbiAgaGFuZGxlRm9jdXM6ICgpID0+IHZvaWRcbiAgdGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IFNlYXJjaElucHV0X19pbnB1dCB9ID0gc3R5bGVzXG4gICAgY29uc3QgeyBrZXl3b3JkIH0gPSB0aGlzLmluaXRhbFN0YXRlXG5cbiAgICByZXR1cm4gYFxuICAgICAgPGlucHV0IGNsYXNzPScke1NlYXJjaElucHV0X19pbnB1dH0nIHR5cGU9J3RleHQnIHBsYWNlaG9sZGVyPSfsm7ntiLDsoJzrqqksIOyekeqwgOydtOumhOycvOuhnCDqsoDsg4knIHZhbHVlPScke2tleXdvcmR9Jy8+XG4gICAgYFxuICB9XG5cbiAgc2V0dXAoKTogdm9pZCB7XG4gICAgY29uc3QgeyBvbklucHV0IH0gPSB0aGlzLmluaXRhbFN0YXRlXG5cbiAgICB0aGlzLmhhbmRsZUlucHV0ID0gKGUpOiB2b2lkID0+IHtcbiAgICAgIG9uSW5wdXQoZS50YXJnZXQudmFsdWUpXG4gICAgfVxuXG4gICAgdGhpcy5oYW5kbGVGb2N1cyA9ICgpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0ICRpbnB1dCA9IHRoaXMubm9kZSBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgICAkaW5wdXQuZm9jdXMoKVxuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50KCk6IHZvaWQge1xuICAgIHRoaXMubm9kZS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHRoaXMuaGFuZGxlSW5wdXQpXG4gICAgdGhpcy5oYW5kbGVGb2N1cygpXG4gIH1cblxuICBjbGVhckV2ZW50KCk6IHZvaWQge1xuICAgIHRoaXMubm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdpbnB1dCcsIHRoaXMuaGFuZGxlSW5wdXQpXG4gIH1cbn1cblxuaW50ZXJmYWNlIElTZWFyY2hJbnB1dFN0YXRlIHtcbiAga2V5d29yZDogc3RyaW5nXG4gIG9uSW5wdXQ/KGtleXdvcmQ6IHN0cmluZyk6IHZvaWRcbn1cbiIsIi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpblxuZXhwb3J0IGRlZmF1bHQge1wicmVzdWx0X2xpc3RcIjpcImhqQ2RjbzI3bEpKVG8yb3lSTjV3XCIsXCJzZWxlY3RlZFwiOlwieXFCcVd4aVI5QVN0R0I1OHJMZlNcIixcIm1hdGNoZWRcIjpcIk9BZjVKd2tEOW9TT0pXcGxXS18wXCJ9OyIsImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0Bjb21wb25lbnRzJ1xuaW1wb3J0IHN0eWxlcyBmcm9tICcuL1NlYXJjaFJlc3VsdC5tb2R1bGUuc2NzcydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VhcmNoUmVzdWx0IGV4dGVuZHMgQ29tcG9uZW50PElTZWFyY2hSZXN1bHRTdGF0ZT4ge1xuICBoYW5kbGVDbGljazogKHNlbGVjdGVkSXRlbTogYW55KSA9PiB2b2lkXG4gIHRlbXBsYXRlKCk6IHN0cmluZyB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEluZGV4LCBpc1Jlc3VsdExpc3RWaXNpYWJsZSwgbGlzdERhdGEsIGtleXdvcmQgfSA9XG4gICAgICB0aGlzLmluaXRhbFN0YXRlXG4gICAgY29uc3QgeyByZXN1bHRfbGlzdCwgc2VsZWN0ZWQsIG1hdGNoZWQgfSA9IHN0eWxlc1xuXG4gICAgY29uc3QgbWF0Y2hLZXl3b3JkID0gKGl0ZW06IGFueSwga2V5d29yZDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICAgIGlmICghaXRlbS5pbmNsdWRlcyhrZXl3b3JkKSkge1xuICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgfVxuXG4gICAgICBjb25zdCBtYXRjaFRleHQgPSBpdGVtLm1hdGNoKG5ldyBSZWdFeHAoa2V5d29yZCwgJ2dpJykpWzBdXG5cbiAgICAgIHJldHVybiBpdGVtLnJlcGxhY2UoXG4gICAgICAgIG5ldyBSZWdFeHAobWF0Y2hUZXh0LCAnZ2knKSxcbiAgICAgICAgYDxzcGFuIGNsYXNzPScke21hdGNoZWR9Jz4ke21hdGNoVGV4dH08L3NwYW4+YFxuICAgICAgKVxuICAgIH1cblxuICAgIHJldHVybiBgXG4gICAgICA8dWwgY2xhc3M9JyR7aXNSZXN1bHRMaXN0VmlzaWFibGUgPyBgJHtyZXN1bHRfbGlzdH1gIDogJ2hpZGUnfSc+XG4gICAgICAke0FycmF5LmZyb20obGlzdERhdGEpXG4gICAgICAgID8ubWFwKFxuICAgICAgICAgIChpdGVtLCBpbmRleCkgPT5cbiAgICAgICAgICAgIGA8bGkgY2xhc3M9JyR7XG4gICAgICAgICAgICAgIGluZGV4ID09PSBzZWxlY3RlZEluZGV4ID8gYCR7c2VsZWN0ZWR9YCA6ICcnXG4gICAgICAgICAgICB9JyBkYXRhLWluZGV4PScke2luZGV4fSc+XG4gICAgICAgICAgICAgIDxzcGFuPiR7bWF0Y2hLZXl3b3JkKGl0ZW0udGl0bGUsIGtleXdvcmQpfTwvc3Bhbj5cbiAgICAgICAgICAgICAgPHNwYW4+WyAke21hdGNoS2V5d29yZChpdGVtLmF1dGhvciwga2V5d29yZCl9IF0gPC9zcGFuPlxuICAgICAgICAgICAgPC9saT5gXG4gICAgICAgIClcbiAgICAgICAgLmpvaW4oJycpfVxuICAgICAgPC91bD5cbiAgICBgXG4gIH1cblxuICBzZXR1cCgpOiB2b2lkIHtcbiAgICBjb25zdCB7IG9uQ2xpY2sgfSA9IHRoaXMuaW5pdGFsU3RhdGVcblxuICAgIHRoaXMuaGFuZGxlQ2xpY2sgPSAoZSk6IHZvaWQgPT4ge1xuICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnRcbiAgICAgIGNvbnN0ICRsaSA9IHRhcmdldC5jbG9zZXN0KCdsaScpXG4gICAgICBpZiAoJGxpKSB7XG4gICAgICAgIGNvbnN0IHsgaW5kZXggfSA9ICRsaS5kYXRhc2V0XG4gICAgICAgIG9uQ2xpY2sodGhpcy5pbml0YWxTdGF0ZS5saXN0RGF0YVtwYXJzZUludChpbmRleCldLCBpbmRleClcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzZXRFdmVudCgpOiB2b2lkIHtcbiAgICB0aGlzLm5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZUNsaWNrKVxuXG4gICAgY29uc3QgeyBzZWxlY3RlZEluZGV4IH0gPSB0aGlzLmluaXRhbFN0YXRlXG5cbiAgICBjb25zdCB0ZW1wID0gNDAuNSAvL2xpIHNpemVcbiAgICBpZiAoKHNlbGVjdGVkSW5kZXggPiAwICYmIHNlbGVjdGVkSW5kZXggPD0gMykgfHwgc2VsZWN0ZWRJbmRleCA9PT0gMCkge1xuICAgICAgdGhpcy5ub2RlLnNjcm9sbFRvKDAsIDApXG4gICAgfVxuXG4gICAgaWYgKHNlbGVjdGVkSW5kZXggPiAzKSB7XG4gICAgICB0aGlzLm5vZGUuc2Nyb2xsVG8oMCwgdGVtcCAqIChzZWxlY3RlZEluZGV4IC0gMykpXG4gICAgfVxuICB9XG5cbiAgY2xlYXJFdmVudCgpOiB2b2lkIHtcbiAgICB0aGlzLm5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZUNsaWNrKVxuICB9XG59XG5cbmludGVyZmFjZSBJU2VhcmNoUmVzdWx0U3RhdGUge1xuICBpc1Jlc3VsdExpc3RWaXNpYWJsZTogYm9vbGVhblxuICBzZWxlY3RlZEluZGV4OiBudW1iZXJcbiAgbGlzdERhdGE6IElJdGVtW11cbiAga2V5d29yZDogc3RyaW5nXG4gIG9uQ2xpY2soc2VsZWN0ZWRJdGVtOiBhbnksIGluZGV4OiBzdHJpbmcpOiB2b2lkXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUl0ZW0ge1xuICB3ZWJ0b29uSWQ6IG51bWJlclxuICB0aXRsZTogc3RyaW5nXG4gIGF1dGhvcjogc3RyaW5nXG4gIGltZzogc3RyaW5nXG4gIHNlcnZpY2U6IHN0cmluZ1xuICB1cGRhdGVEYXlzOiBzdHJpbmdbXVxuICB1cmw6IHN0cmluZ1xufVxuIiwiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGNvbXBvbmVudHMnXG5pbXBvcnQgdHlwZSB7IElJdGVtIH0gZnJvbSAnLi4vU2VhcmNoUmVzdWx0J1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWFyY2hJdGVtSW5mbyBleHRlbmRzIENvbXBvbmVudDxJU2VhcmNoSXRlbUluZm9TdGF0ZT4ge1xuICB0ZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHsgaXNNb2RhbFZpc2lhYmxlLCBzZWxlY3RlZEl0ZW0gfSA9IHRoaXMuaW5pdGFsU3RhdGVcbiAgICByZXR1cm4gYFxuICAgIDxkaXY+XG4gICAgJHtcbiAgICAgIGlzTW9kYWxWaXNpYWJsZVxuICAgICAgICA/IGBcbiAgICAgIDxkaXYgY2xhc3M9J2l0ZW1faW5mbycgPlxuICAgICAgICA8ZGl2IGNsYXNzPSdtb2RhbCc+XG4gICAgICAgICAgPGJ1dHRvbj5YPC9idXR0b24+IFxuICAgICAgICAgIDxhIGhyZWY9JyR7c2VsZWN0ZWRJdGVtLnVybH0nIHRhcmdldD0nX2JsYW5rJz5cbiAgICAgICAgICAgIDxpbWcgc3JjPScke3NlbGVjdGVkSXRlbS5pbWd9JyAvPlxuICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8cD7sm7ntiLAg7KCc66qpOiAke3NlbGVjdGVkSXRlbS50aXRsZX08L3A+XG4gICAgICAgICAgPHA+7J6R6rCAOiAke3NlbGVjdGVkSXRlbS5hdXRob3J9PC9wPlxuICAgICAgICAgIDxwPuyXsOyerCDsgqzsnbTtirg6ICR7c2VsZWN0ZWRJdGVtLnNlcnZpY2V9PC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgYFxuICAgICAgICA6ICcnXG4gICAgfVxuICAgIDwvZGl2PlxuICAgIGBcbiAgfVxufVxuXG5pbnRlcmZhY2UgSVNlYXJjaEl0ZW1JbmZvU3RhdGUge1xuICBzZWxlY3RlZEl0ZW06IElJdGVtXG4gIGlzTW9kYWxWaXNpYWJsZTogYm9vbGVhblxufVxuIiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQgZGVmYXVsdCB7XCJlcnJvcl9tZWdcIjpcIm1hd0w1allQYmxtWHhjd0o3ZjNYXCIsXCJ1cFwiOlwiRUE1S2ZZU0psU0E1TGpnM1d5bnNcIn07IiwiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGNvbXBvbmVudHMnXG5pbXBvcnQgc3R5bGVzIGZyb20gJy4vRXJyb3JNZWcubW9kdWxlLnNjc3MnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVycm9yTWVnIGV4dGVuZHMgQ29tcG9uZW50PElFcnJvck1lZ1N0YXRlPiB7XG4gIHRlbXBsYXRlKCk6IHN0cmluZyB7XG4gICAgY29uc3QgeyBpc0Vycm9yTWVnLCBrZXl3b3JkLCBpc1Jlc3VsdExpc3RWaXNpYWJsZSB9ID0gdGhpcy5pbml0YWxTdGF0ZVxuICAgIGNvbnN0IHsgZXJyb3JfbWVnIH0gPSBzdHlsZXNcblxuICAgIGNvbnN0IGtleXdvcmRFcnJvciA9IGA8c3Bhbj7qsoDsg4nslrTrpbwg7J6F66Cl7ZW07KO87IS47JqUIDopPC9zcGFuPmBcbiAgICBjb25zdCBsZW5ndGhFcnJvciA9IGA8c3Bhbj48c3Ryb25nPifrkZAg6riA7J6QJzwvc3Ryb25nPiDrtoDthLAg6rKA7IOJ7J20IOqwgOuKpe2VqeuLiOuLpCA6KTwvc3Bhbj5gXG4gICAgY29uc3Qgbm9uZVJlc3VsdEVycm9yID0gYDxzcGFuPjxzdHJvbmc+JyR7a2V5d29yZH0nPC9zdHJvbmc+IOydmCDqsoDsg4kg6rKw6rO86rCAIOyXhuyKteuLiOuLpCA6PDwvc3Bhbj5gXG5cbiAgICBjb25zdCBFcnJvclR5cGUgPSAoKTogc3RyaW5nID0+IHtcbiAgICAgIGlmIChrZXl3b3JkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ga2V5d29yZEVycm9yXG4gICAgICB9XG5cbiAgICAgIGlmIChrZXl3b3JkLmxlbmd0aCA8IDIgJiYga2V5d29yZC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiBsZW5ndGhFcnJvclxuICAgICAgfVxuXG4gICAgICBpZiAoIWlzUmVzdWx0TGlzdFZpc2lhYmxlICYmIGtleXdvcmQubGVuZ3RoID49IDIpIHtcbiAgICAgICAgcmV0dXJuIG5vbmVSZXN1bHRFcnJvclxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBgXG4gICAgPGRpdiBjbGFzcz0nJHtlcnJvcl9tZWd9Jz5cbiAgICAke2lzRXJyb3JNZWcgPyBFcnJvclR5cGUoKSA6ICcnfVxuICAgIDwvZGl2PlxuICAgIGBcbiAgfVxufVxuXG5pbnRlcmZhY2UgSUVycm9yTWVnU3RhdGUge1xuICBrZXl3b3JkOiBzdHJpbmdcbiAgaXNFcnJvck1lZzogYm9vbGVhblxuICBpc1Jlc3VsdExpc3RWaXNpYWJsZTogYm9vbGVhblxufVxuXG4vLyA8ZGl2IGNsYXNzPScke2Vycm9yX21lZ30nPlxuLy8gJHtpc0Vycm9yTWVnID8gKGtleXdvcmQubGVuZ3RoID09PSAwID8ga2V5d29yZEVycm9yIDogbGVuZ3RoRXJyb3IpIDogJyd9XG4vLyA8L2Rpdj5cbiIsImltcG9ydCB7IHNlbGVjdEVsIH0gZnJvbSAnQHV0aWxzJ1xuaW1wb3J0IEFwcCBmcm9tICdBcHAnXG5pbXBvcnQgJy4vc2Nzcy9pbmRleC5zY3NzJ1xuXG5uZXcgQXBwKHsgbm9kZTogc2VsZWN0RWwoZG9jdW1lbnQsICcjcm9vdCcpLCBpbml0YWxTdGF0ZTogbnVsbCB9KVxuIiwiaW1wb3J0IHsgYXBpIH0gZnJvbSAnQGFwaSdcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgU2VhcmNoSW5wdXQsXG4gIFNlYXJjaFJlc3VsdCxcbiAgU2VhcmNoSXRlbUluZm8sXG4gIEVycm9yTWVnXG59IGZyb20gJ0Bjb21wb25lbnRzJ1xuaW1wb3J0IHR5cGUgeyBJQ29tcG9uZW50UHJvcHMgfSBmcm9tICdAY29tcG9uZW50cy9jb3JlL0NvbXBvbmVudCdcbmltcG9ydCB0eXBlIHsgSUl0ZW0gfSBmcm9tICdAY29tcG9uZW50cy9zZWFyY2gvU2VhcmNoUmVzdWx0J1xuaW1wb3J0IHsgZGVib3VuY2UsIHNlbGVjdEVsLCBnZXRJdGVtIH0gZnJvbSAnQHV0aWxzJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBcHAgZXh0ZW5kcyBDb21wb25lbnQ8SUFwcFN0YXRlPiB7XG4gIGhhbmRsZUNoYW5nZTogKGtleXdvcmQ6IHN0cmluZykgPT4gdm9pZFxuICBoYW5kbGVLZXlDaGFuZ2U6IChlOiBhbnkpID0+IHZvaWRcbiAgaGFuZGxlQ2xpY2s6IChlOiBhbnkpID0+IHZvaWRcbiAgY29uc3RydWN0b3IoeyBub2RlIH06IElDb21wb25lbnRQcm9wczxJQXBwU3RhdGU+KSB7XG4gICAgY29uc3QgaW5pdGFsU3RhdGUgPSB7XG4gICAgICBrZXl3b3JkOiAnJyxcbiAgICAgIHNlbGVjdGVkSW5kZXg6IDAsXG4gICAgICBsaXN0RGF0YTogW10sXG4gICAgICBzZWxlY3RlZEl0ZW06IHt9LFxuICAgICAgaXNSZXN1bHRMaXN0VmlzaWFibGU6IGZhbHNlLFxuICAgICAgaXNNb2RhbFZpc2lhYmxlOiBmYWxzZSxcbiAgICAgIGlzRXJyb3JNZWc6IHRydWVcbiAgICB9IGFzIElBcHBTdGF0ZVxuXG4gICAgc3VwZXIoeyBub2RlLCBpbml0YWxTdGF0ZSB9KVxuICB9XG5cbiAgc2V0dXAoKTogdm9pZCB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IC4uLnRoaXMuaW5pdGFsU3RhdGUsIC4uLmdldEl0ZW0oJ3NlYXJjaFN0YXRlJykgfSlcbiAgICB0aGlzLmhhbmRsZUNoYW5nZSA9IGRlYm91bmNlKGFzeW5jIChrZXl3b3JkKTogUHJvbWlzZTxhbnk+ID0+IHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tY29uZnVzaW5nLXZvaWQtZXhwcmVzc2lvblxuICAgICAgY29uc3QgbGlzdERhdGEgPSBhd2FpdCBhcGkuZ2V0V2ViVG9vbkxpc3Qoa2V5d29yZClcbiAgICAgIGlmICgha2V5d29yZCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBpc1Jlc3VsdExpc3RWaXNpYWJsZTogZmFsc2UsXG4gICAgICAgICAgc2VsZWN0ZWRJbmRleDogMCxcbiAgICAgICAgICBrZXl3b3JkOiAnJyxcbiAgICAgICAgICBsaXN0RGF0YTogbGlzdERhdGEubGVuZ3RoID8gbGlzdERhdGEgOiBbXSxcbiAgICAgICAgICBzZWxlY3RlZEl0ZW06IHt9XG4gICAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBpc1Jlc3VsdExpc3RWaXNpYWJsZTogbGlzdERhdGEubGVuZ3RoID4gMCxcbiAgICAgICAgICBsaXN0RGF0YTogbGlzdERhdGEsXG4gICAgICAgICAga2V5d29yZDoga2V5d29yZCxcbiAgICAgICAgICBpc0Vycm9yTWVnOiBsaXN0RGF0YS5sZW5ndGggPiAwID8gZmFsc2UgOiB0cnVlXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSwgMjAwKVxuXG4gICAgdGhpcy5oYW5kbGVLZXlDaGFuZ2UgPSAoZSk6IHZvaWQgPT4ge1xuICAgICAgY29uc3QgeyBsaXN0RGF0YSwgc2VsZWN0ZWRJbmRleCB9ID0gdGhpcy5pbml0YWxTdGF0ZVxuXG4gICAgICBjb25zdCBBQ1RJT05LRVlTID0ge1xuICAgICAgICBBUlJPV1VQOiAnQXJyb3dVcCcsXG4gICAgICAgIEFSUk9XRE9XTjogJ0Fycm93RG93bicsXG4gICAgICAgIEVOVEVSOiAnRW50ZXInLFxuICAgICAgICBFU0NBUEU6ICdFc2NhcGUnXG4gICAgICB9XG5cbiAgICAgIGlmIChPYmplY3QudmFsdWVzKEFDVElPTktFWVMpLmluY2x1ZGVzKGUua2V5KSAmJiAhbGlzdERhdGEubGVuZ3RoKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBjb25zdCBsYXN0SW5kZXggPSBsaXN0RGF0YS5sZW5ndGggLSAxXG4gICAgICBsZXQgbmV4dEluZGV4ID0gc2VsZWN0ZWRJbmRleFxuXG4gICAgICBzd2l0Y2ggKGUua2V5KSB7XG4gICAgICAgIGNhc2UgQUNUSU9OS0VZUy5BUlJPV1VQOlxuICAgICAgICAgIG5leHRJbmRleCA9IHNlbGVjdGVkSW5kZXggPT09IDAgPyBsYXN0SW5kZXggOiBuZXh0SW5kZXggLSAxXG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzZWxlY3RlZEluZGV4OiBuZXh0SW5kZXhcbiAgICAgICAgICB9KVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgQUNUSU9OS0VZUy5BUlJPV0RPV046XG4gICAgICAgICAgbmV4dEluZGV4ID0gc2VsZWN0ZWRJbmRleCA9PT0gbGFzdEluZGV4ID8gMCA6IG5leHRJbmRleCArIDFcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IG5leHRJbmRleFxuICAgICAgICAgIH0pXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSBBQ1RJT05LRVlTLkVOVEVSOlxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtOiBsaXN0RGF0YVtzZWxlY3RlZEluZGV4XSxcbiAgICAgICAgICAgIGlzTW9kYWxWaXNpYWJsZTogdHJ1ZVxuICAgICAgICAgIH0pXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSBBQ1RJT05LRVlTLkVTQ0FQRTpcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGlzTW9kYWxWaXNpYWJsZTogZmFsc2VcbiAgICAgICAgICB9KVxuICAgICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5oYW5kbGVDbGljayA9IChlKTogdm9pZCA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJ2J1dHRvbicpIHx8XG4gICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnaXRlbV9pbmZvJylcbiAgICAgICkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBpc01vZGFsVmlzaWFibGU6IGZhbHNlXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFxuICAgICAgPG1haW4gaWQ9J3Jvb3QnPlxuICAgICAgICA8aGVhZGVyIGNsYXNzPSdoZWFkZXInPldlYnRvb25zIFNlYXJjaDwvaGVhZGVyPlxuICAgICAgICA8ZGl2IGNsYXNzPSdjb250YWluZXInPlxuICAgICAgICAgIDxTZWFyY2hJbnB1dD48L1NlYXJjaElucHV0PlxuICAgICAgICAgIDxFcnJvck1lc3NhZ2U+PC9FcnJvck1lc3NhZ2U+XG4gICAgICAgICAgPFNlYXJjaFJlc3VsdExpc3Q+PC9TZWFyY2hSZXN1bHRMaXN0PlxuICAgICAgICAgIDxTZWFyY2hJdGVtSW5mbz48L1NlYXJjaEl0ZW1JbmZvPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvbWFpbj5cbiAgYFxuICB9XG5cbiAgcmVuZGVyQ2hpbGRDb21wb25lbnQoKTogdm9pZCB7XG4gICAgY29uc3Qge1xuICAgICAga2V5d29yZCxcbiAgICAgIHNlbGVjdGVkSW5kZXgsXG4gICAgICBsaXN0RGF0YSxcbiAgICAgIGlzUmVzdWx0TGlzdFZpc2lhYmxlLFxuICAgICAgc2VsZWN0ZWRJdGVtLFxuICAgICAgaXNNb2RhbFZpc2lhYmxlLFxuICAgICAgaXNFcnJvck1lZ1xuICAgIH0gPSB0aGlzLmluaXRhbFN0YXRlXG5cbiAgICBuZXcgU2VhcmNoSW5wdXQoe1xuICAgICAgbm9kZTogc2VsZWN0RWwodGhpcy5ub2RlLCAnU2VhcmNoSW5wdXQnKSxcbiAgICAgIGluaXRhbFN0YXRlOiB7XG4gICAgICAgIGtleXdvcmQ6IHRoaXMuaW5pdGFsU3RhdGUua2V5d29yZCxcbiAgICAgICAgb25JbnB1dDogdGhpcy5oYW5kbGVDaGFuZ2VcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgZXJyb3JNZWcgPSBuZXcgRXJyb3JNZWcoe1xuICAgICAgbm9kZTogc2VsZWN0RWwodGhpcy5ub2RlLCAnRXJyb3JNZXNzYWdlJyksXG4gICAgICByZW5kZXJTdGF0ZUtleTogWydzZWxlY3RlZEl0ZW0nLCAnc2VsZWN0ZWRJbmRleCddLFxuICAgICAgaW5pdGFsU3RhdGU6IHsgaXNFcnJvck1lZywga2V5d29yZCwgaXNSZXN1bHRMaXN0VmlzaWFibGUgfVxuICAgIH0pXG5cbiAgICBjb25zdCBzZWFyY2hSZXN1bHQgPSBuZXcgU2VhcmNoUmVzdWx0KHtcbiAgICAgIG5vZGU6IHNlbGVjdEVsKHRoaXMubm9kZSwgJ1NlYXJjaFJlc3VsdExpc3QnKSxcbiAgICAgIGluaXRhbFN0YXRlOiB7XG4gICAgICAgIGtleXdvcmQsXG4gICAgICAgIGxpc3REYXRhLFxuICAgICAgICBpc1Jlc3VsdExpc3RWaXNpYWJsZSxcbiAgICAgICAgc2VsZWN0ZWRJbmRleCxcbiAgICAgICAgb25DbGljazogKHNlbGVjdGVkSXRlbTogYW55LCBpbmRleDogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW06IHNlbGVjdGVkSXRlbSxcbiAgICAgICAgICAgIGlzTW9kYWxWaXNpYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IE51bWJlcihpbmRleClcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IHNlYXJjaEl0ZW1JbmZvID0gbmV3IFNlYXJjaEl0ZW1JbmZvKHtcbiAgICAgIG5vZGU6IHNlbGVjdEVsKHRoaXMubm9kZSwgJ1NlYXJjaEl0ZW1JbmZvJyksXG4gICAgICBpbml0YWxTdGF0ZToge1xuICAgICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICAgIGlzTW9kYWxWaXNpYWJsZVxuICAgICAgfVxuICAgIH0pXG5cbiAgICB0aGlzLnN1YnNjcmliZShzZWFyY2hSZXN1bHQpXG4gICAgdGhpcy5zdWJzY3JpYmUoc2VhcmNoSXRlbUluZm8pXG4gICAgdGhpcy5zdWJzY3JpYmUoZXJyb3JNZWcpXG4gIH1cblxuICBzZXRFdmVudCgpOiB2b2lkIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmhhbmRsZUtleUNoYW5nZSlcbiAgICB0aGlzLm5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZUNsaWNrKVxuICB9XG5cbiAgY2xlYXJFdmVudCgpOiB2b2lkIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmhhbmRsZUtleUNoYW5nZSlcbiAgICB0aGlzLm5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZUNsaWNrKVxuICB9XG59XG5cbmludGVyZmFjZSBJQXBwU3RhdGUge1xuICBrZXl3b3JkOiBzdHJpbmdcbiAgc2VsZWN0ZWRJbmRleDogbnVtYmVyXG4gIGxpc3REYXRhOiBJSXRlbVtdXG4gIHNlbGVjdGVkSXRlbTogSUl0ZW1cbiAgaXNSZXN1bHRMaXN0VmlzaWFibGU6IGJvb2xlYW5cbiAgaXNNb2RhbFZpc2lhYmxlOiBib29sZWFuXG4gIGlzRXJyb3JNZWc6IGJvb2xlYW5cbn1cbiIsImNvbnN0IGRlYm91bmNlOiBJRGVib3VuY2UgPSAoY2FsbGJhY2ssIGRlbGF5KSA9PiB7XG4gIGxldCB0aW1lb3V0OiBudW1iZXJcblxuICByZXR1cm4gZXZlbnQgPT4ge1xuICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dClcbiAgICB9XG5cbiAgICB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIGRlbGF5LCBldmVudClcbiAgfVxufVxuXG5leHBvcnQgeyBkZWJvdW5jZSB9XG5cbnR5cGUgSURlYm91bmNlID0gKFxuICBjYWxsYmFjazogKGV2ZW50OiBhbnkpID0+IHZvaWQsXG4gIGRlbGF5OiBudW1iZXJcbikgPT4gKGV2ZW50OiBhbnkpID0+IHZvaWRcbiIsImltcG9ydCB7IEJBU0VfVVJMLCBSRVFVU0VUX01FU1NBR0UgfSBmcm9tICdAY29uc3RhbnRzJ1xuXG5jb25zdCByZXF1c2V0ID0gYXN5bmMgKHVybDogc3RyaW5nKTogUHJvbWlzZTxhbnk+ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybClcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoUkVRVVNFVF9NRVNTQUdFLkhUVFBfRVJST1IpXG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICByZXR1cm4gZGF0YS53ZWJ0b29uc1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYCR7UkVRVVNFVF9NRVNTQUdFLlNFUlZFUl9FUlJPUn0gJHtlcnJvci5tZXNzYWdlfWApXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGFwaSA9IHtcbiAgZ2V0V2ViVG9vbkxpc3Q6IGFzeW5jIChrZXl3b3JkOiBzdHJpbmcpOiBQcm9taXNlPGFueT4gPT5cbiAgICByZXF1c2V0KGAke0JBU0VfVVJMfS9zZWFyY2g/a2V5d29yZD0ke2tleXdvcmR9YClcbn1cbiIsImNvbnN0IEJBU0VfVVJMID0gJ2h0dHBzOi8va29yZWEtd2VidG9vbi1hcGkuaGVyb2t1YXBwLmNvbSdcbmNvbnN0IFJFUVVTRVRfTUVTU0FHRSA9IHtcbiAgSFRUUF9FUlJPUjogJ+yEnOuyhOyZgOydmCDsl7DqsrDsnbQg67aI7JWI7KCV7ZWp64uI64ukIScsXG4gIFNFUlZFUl9FUlJPUjogJ+yXkOufrOqwgCDrsJzsg53tlojsirXri4jri6QhJ1xufVxuZXhwb3J0IHsgQkFTRV9VUkwsIFJFUVVTRVRfTUVTU0FHRSB9XG4iXSwibmFtZXMiOlsic2VsZWN0RWwiLCJzY29wZSIsImRvY3VtZW50Iiwic2VsZWN0b3IiLCJxdWVyeVNlbGVjdG9yIiwiQ29udmVydFRlbXBsYXRlVG9Db21wb25lbnQiLCJvbGROb2RlIiwidGhpcyIsIm5vZGUiLCJjb21wb25lbnRDaGlsZHJlbiIsIkFycmF5IiwiZnJvbSIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsInRlbXBsYXRlIiwiYm9keSIsImNoaWxkcmVuIiwiY29tcG9uZW50IiwiRG9jdW1lbnRGcmFnbWVudCIsImFwcGVuZCIsImFmdGVyIiwibmV4dFNpYmxpbmciLCJvbGRDU1MiLCJjbGFzc0xpc3QiLCJ2YWx1ZSIsInRyaW0iLCJuZXdDU1MiLCJjc3NWYWx1ZSIsImNsYXNzTmFtZSIsInJlbW92ZSIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwiaW5pdGFsU3RhdGUiLCJyZW5kZXJTdGF0ZUtleSIsIlNldCIsInN1YnNjcmliZXJzIiwiaXNOZWVkUmVuZGVyIiwiaXNOZWVkVXBkYXRlIiwic2V0dXAiLCJyZW5kZXIiLCJ3aW5kb3ciLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjYWxsIiwic2V0RXZlbnQiLCJyZW5kZXJDaGlsZENvbXBvbmVudCIsInVwZGF0ZXIiLCJjbGVhckV2ZW50Iiwic3Vic2NyaWJlIiwiZm9yRWFjaCIsInN1YnNjcmliZXIiLCJhZGQiLCJub3RpZnkiLCJuZXdTdGF0ZSIsInNldFN0YXRlIiwiY2hlY2tVcGRhdGFTdGF0ZSIsInJlZmxlY3ROZWVkUmVuZGVyIiwicmVmbGVjdFN0YXRlIiwia2V5IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvciIsIkVycm9yIiwiY3VycmVudFN0YXRlIiwibmV4dFN0YXRlIiwidXBkYXRlZFN0YXRlS2V5cyIsIk9iamVjdCIsImtleXMiLCJzdGF0ZSIsImZpbHRlciIsImluY2x1ZGVzIiwibGVuZ3RoIiwic3RhdGVLZXkiLCJTZWFyY2hJbnB1dCIsIlNlYXJjaElucHV0X19pbnB1dCIsImtleXdvcmQiLCJvbklucHV0IiwiaGFuZGxlSW5wdXQiLCJlIiwidGFyZ2V0IiwiaGFuZGxlRm9jdXMiLCJmb2N1cyIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiU2VhcmNoUmVzdWx0Iiwic2VsZWN0ZWRJbmRleCIsImlzUmVzdWx0TGlzdFZpc2lhYmxlIiwibGlzdERhdGEiLCJyZXN1bHRfbGlzdCIsInNlbGVjdGVkIiwibWF0Y2hlZCIsIm1hdGNoS2V5d29yZCIsIml0ZW0iLCJtYXRjaFRleHQiLCJtYXRjaCIsIlJlZ0V4cCIsInJlcGxhY2UiLCJtYXAiLCJpbmRleCIsInRpdGxlIiwiYXV0aG9yIiwiam9pbiIsIm9uQ2xpY2siLCJoYW5kbGVDbGljayIsIiRsaSIsImNsb3Nlc3QiLCJkYXRhc2V0IiwicGFyc2VJbnQiLCJzY3JvbGxUbyIsIlNlYXJjaEl0ZW1JbmZvIiwiaXNNb2RhbFZpc2lhYmxlIiwic2VsZWN0ZWRJdGVtIiwidXJsIiwiaW1nIiwic2VydmljZSIsIkVycm9yTWVnIiwiaXNFcnJvck1lZyIsImVycm9yX21lZyIsIm5vbmVSZXN1bHRFcnJvciIsInN1cGVyIiwiZ2V0SXRlbSIsInBhcnNlIiwiaGFuZGxlQ2hhbmdlIiwiY2FsbGJhY2siLCJkZWxheSIsInRpbWVvdXQiLCJldmVudCIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJkZWJvdW5jZSIsInJlc3BvbnNlIiwiZmV0Y2giLCJvayIsImpzb24iLCJ3ZWJ0b29ucyIsImNvbnNvbGUiLCJtZXNzYWdlIiwiYXBpIiwiaGFuZGxlS2V5Q2hhbmdlIiwiQUNUSU9OS0VZUyIsIkFSUk9XVVAiLCJBUlJPV0RPV04iLCJFTlRFUiIsIkVTQ0FQRSIsInZhbHVlcyIsImxhc3RJbmRleCIsIm5leHRJbmRleCIsInByZXZlbnREZWZhdWx0IiwiY29udGFpbnMiLCJlcnJvck1lZyIsInNlYXJjaFJlc3VsdCIsIk51bWJlciIsInNlYXJjaEl0ZW1JbmZvIl0sInNvdXJjZVJvb3QiOiIifQ==