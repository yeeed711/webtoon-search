(()=>{"use strict";(()=>{const e=(e=document,t)=>e.querySelector(t);function t(){const e=this.node,t=Array.from((new DOMParser).parseFromString(this.template(),"text/html").body.children),s=new DocumentFragment;s.append(...t),e.after(s),this.node=e.nextSibling;const n=e.classList.value.trim(),i=this.node.classList.value.trim(),a=n!==i&&i||n;a?(this.node.className=a,e.remove()):e.remove()}const s={ARROWUP:"ArrowUp",ARROWDOWN:"ArrowDown",ENTER:"Enter",ESCAPE:"Escape"};var n=function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))};class i{constructor({node:e,initalState:t,renderStateKey:s=[]}){this.node=e,this.initalState=t,this.renderStateKey=new Set(s),this.subscribers=new Set([]),this.isNeedRender=!1,this.isNeedUpdate=!1,this.setup(),this.render()}setup(){}render(){window.requestAnimationFrame((()=>{t.call(this),this.setEvent(),this.renderChildComponent()}))}updater(){this.isNeedRender?(this.clearEvent(),this.render()):this.renderChildComponent()}renderChildComponent(){}setEvent(){}clearEvent(){}template(){return""}subscribe(...e){e.forEach((e=>{this.subscribers.add(e)}))}notify(e){Array.from(this.subscribers).forEach((t=>{t.setState(e),t.updater(),t.isNeedRender=!1}))}setState(e){this.checkUpdataState(e),this.isNeedUpdate&&(this.reflectNeedRender(e),this.reflectState(e),this.notify(e),((e,t)=>{try{sessionStorage.setItem("searchState",JSON.stringify(t))}catch(e){throw new Error("저장이 되지 않았습니다!")}})(0,this.initalState))}checkUpdataState(e){const t=JSON.stringify(Object.assign({},this.initalState)),s=JSON.stringify(Object.assign(Object.assign({},this.initalState),e));this.isNeedUpdate=t!==s}reflectNeedRender(e){const t=Object.keys(e),s=Array.from(this.renderStateKey),n=t.filter((e=>s.includes(e)));this.isNeedRender=0===n.length}reflectState(e){Object.keys(e).forEach((t=>{const s=t;this.initalState[s]=e[s]}))}}const a={SearchInput__input:"oZFdS8AMjR5RMYyBNvKV"};class r extends i{template(){const{SearchInput__input:e}=a,{keyword:t}=this.initalState;return`\n        <input class='${e}' type='text' placeholder='웹툰제목, 작가이름으로 검색' value='${t}'/>\n      `}setup(){const{onInput:e}=this.initalState;this.handleInput=t=>{e(t.target.value)},this.handleFocus=()=>{this.node.focus()}}setEvent(){this.node.addEventListener("input",this.handleInput),this.handleFocus()}clearEvent(){this.node.removeEventListener("input",this.handleInput)}}const o={result_list:"hjCdco27lJJTo2oyRN5w",selected:"yqBqWxiR9AStGB58rLfS",matched:"OAf5JwkD9oSOJWplWK_0"};class l extends i{template(){const{selectedIndex:e,isResultListVisiable:t,listData:s,keyword:n}=this.initalState,{result_list:i,selected:a,matched:r}=o,l=(e,t)=>{if(!e.includes(t))return e;const s=e.match(new RegExp(t,"gi"))[0];return e.replace(new RegExp(s,"gi"),`<span class='${r}'>${s}</span>`)};return`\n        <ul class='${t?i:"hide"}'>\n        ${null===(c=Array.from(s))||void 0===c?void 0:c.map(((t,s)=>`<li ${s===e?`class=${a}`:""} data-index='${s}'>\n                <span>${l(t.title,n)}</span>\n                <span>[ ${l(t.author,n)} ] </span>\n              </li>`)).join("")}\n        </ul>\n      `;var c}setup(){const{onClick:e}=this.initalState;this.handleClick=t=>{const s=t.target.closest("li");if(s){const{index:t}=s.dataset;e(this.initalState.listData[parseInt(t)],t)}}}setEvent(){this.node.addEventListener("click",this.handleClick);const{selectedIndex:e}=this.initalState;(e>0&&e<=3||0===e)&&this.node.scrollTo(0,0),e>3&&this.node.scrollTo(0,40.5*(e-3))}clearEvent(){this.node.removeEventListener("click",this.handleClick)}}const c={item_info:"b_BiEQCaWN0N4grQNoR_",modal:"fVwZcXiNTz_b6jCy8MuZ",info_text_cont:"TBe_D0noTQ1AXQvtqIa2"};class d extends i{template(){const{isModalVisiable:e,selectedItem:t}=this.initalState,{item_info:s,modal:n,info_text_cont:i}=c;return`\n    <div>\n    ${e?`\n        <div class='${s} item_info' >\n          <div\n            class='${n}'\n            style='background-image:linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 1)), url(${t.img});'>\n            <button class="material-icons">cancel</button>\n            <div class='${i}'>\n              <p>${t.title}</p>\n              <p>${t.author}</p>\n              <p>${t.service} 연재</p>\n              <a href='${t.url}' target='_blank'>보러가기</a>\n            </div>\n          </div>\n        </div>      \n      `:""}\n    </div>\n    `}}const h={error_meg:"mawL5jYPblmXxcwJ7f3X",up:"EA5KfYSJlSA5Ljg3Wyns"};class u extends i{template(){const{isErrorMeg:e,keyword:t,isResultListVisiable:s}=this.initalState,{error_meg:n}=h,i=`<span><strong>'${t}'</strong> 의 검색 결과가 없습니다 :(</span>`;return`\n        <div class='${n}'>\n          ${e?0===t.length?"<span>검색어를 입력해주세요 :)</span>":t.length<2&&t.length>0?"<span><strong>'두 글자'</strong> 부터 검색이 가능합니다 :)</span>":!s&&t.length>=2?i:void 0:""}\n        </div>\n      `}}new class extends i{constructor({node:e}){super({node:e,initalState:{keyword:"",selectedIndex:0,listData:[],selectedItem:{},isResultListVisiable:!1,isModalVisiable:!1,isErrorMeg:!0}})}setup(){this.setState(Object.assign(Object.assign({},this.initalState),(e=>{try{const e=sessionStorage.getItem("searchState");return e?JSON.parse(e):[]}catch(e){throw new Error(e)}})())),this.handleChange=((e,t)=>{let s;return t=>{s&&clearTimeout(s),s=window.setTimeout(e,300,t)}})((e=>{return t=this,s=void 0,a=function*(){const t=yield(e=>n(void 0,void 0,void 0,(function*(){return t=`https://korea-webtoon-api.herokuapp.com/search?keyword=${e}`,n(void 0,void 0,void 0,(function*(){try{const e=yield fetch(t);if(!e.ok)throw new Error("서버와의 연결이 불안정합니다!");return(yield e.json()).webtoons}catch(e){console.error(`에러가 발생했습니다! ${e.message}`)}}));var t})))(e);e?this.setState({isResultListVisiable:t.length>0,listData:t,keyword:e,isErrorMeg:!(t.length>0)}):this.setState({isResultListVisiable:!1,selectedIndex:0,keyword:"",listData:t.length?t:[],selectedItem:{}})},new((i=void 0)||(i=Promise))((function(e,n){function r(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,o)}l((a=a.apply(t,s||[])).next())}));var t,s,i,a})),this.handleKeyChange=e=>{const{listData:t,selectedIndex:n}=this.initalState;if(Object.values(s).includes(e.key)&&!t.length)return;const i=t.length-1;let a=n;switch(e.key){case s.ARROWUP:a=0===n?i:a-1,this.setState({selectedIndex:a});break;case s.ARROWDOWN:a=n===i?0:a+1,this.setState({selectedIndex:a});break;case s.ENTER:e.preventDefault(),this.setState({selectedItem:t[n],isModalVisiable:!0});break;case s.ESCAPE:this.setState({isModalVisiable:!1})}},this.handleClick=e=>{const t=e.target;(t.closest("button")||t.classList.contains("item_info"))&&this.setState({isModalVisiable:!1})}}template(){return"\n      <main id='root'>\n        <header class='header'>Webtoons Search</header>\n        <div class='container'>\n          <SearchInput></SearchInput>\n          <ErrorMessage></ErrorMessage>\n          <SearchResultList></SearchResultList>\n          <SearchItemInfo></SearchItemInfo>\n        </div>\n      </main>\n  "}renderChildComponent(){const{keyword:t,selectedIndex:s,listData:n,isResultListVisiable:i,selectedItem:a,isModalVisiable:o,isErrorMeg:c}=this.initalState;new r({node:e(this.node,"SearchInput"),initalState:{keyword:this.initalState.keyword,onInput:this.handleChange}});const h=new u({node:e(this.node,"ErrorMessage"),renderStateKey:["selectedItem","selectedIndex"],initalState:{isErrorMeg:c,keyword:t,isResultListVisiable:i}}),p=new l({node:e(this.node,"SearchResultList"),initalState:{keyword:t,listData:n,isResultListVisiable:i,selectedIndex:s,onClick:(e,t)=>{this.setState({selectedItem:e,isModalVisiable:!0,selectedIndex:Number(t)})}}}),S=new d({node:e(this.node,"SearchItemInfo"),initalState:{selectedItem:a,isModalVisiable:o}});this.subscribe(p),this.subscribe(S),this.subscribe(h)}setEvent(){window.addEventListener("keyup",this.handleKeyChange),this.node.addEventListener("click",this.handleClick)}clearEvent(){window.removeEventListener("keyup",this.handleKeyChange),this.node.removeEventListener("click",this.handleClick)}}({node:e(document,"#root"),initalState:null})})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMvbWFpbi5idW5kbGUuanMiLCJtYXBwaW5ncyI6InlCQUVBLE1BQU1BLEVBQVcsQ0FDZkMsRUFBNEJDLFNBQzVCQyxJQUVPRixFQUFNRyxjQUFjRCxHQVc3QixTQUFTRSxJQUNQLE1BQU1DLEVBQVVDLEtBQUtDLEtBQ2ZDLEVBQW9CQyxNQUFNQyxNQUM5QixJQUFJQyxXQUFZQyxnQkFBZ0JOLEtBQUtPLFdBQVksYUFBYUMsS0FBS0MsVUFFL0RDLEVBQVksSUFBSUMsaUJBQ3RCRCxFQUFVRSxVQUFVVixHQUVwQkgsRUFBUWMsTUFBTUgsR0FDZFYsS0FBS0MsS0FBT0YsRUFBUWUsWUFFcEIsTUFBTUMsRUFBU2hCLEVBQVFpQixVQUFVQyxNQUFNQyxPQUNqQ0MsRUFBU25CLEtBQUtDLEtBQUtlLFVBQVVDLE1BQU1DLE9BRW5DRSxFQURlTCxJQUFXSSxHQUNBQSxHQUFtQkosRUFFOUNLLEdBS0xwQixLQUFLQyxLQUFLb0IsVUFBWUQsRUFFdEJyQixFQUFRdUIsVUFOTnZCLEVBQVF1QixRQU9aLENDeENBLE1BT01DLEVBQWEsQ0FDakJDLFFBQVMsVUFDVEMsVUFBVyxZQUNYQyxNQUFPLFFBQ1BDLE9BQVEsVSwwU0NUSyxNQUFlQyxFQU81QkMsYUFBWSxLQUNWNUIsRUFBSSxZQUNKNkIsRUFBVyxlQUNYQyxFQUFpQixLQUVqQi9CLEtBQUtDLEtBQU9BLEVBQ1pELEtBQUs4QixZQUFjQSxFQUNuQjlCLEtBQUsrQixlQUFpQixJQUFJQyxJQUFJRCxHQUM5Qi9CLEtBQUtpQyxZQUFjLElBQUlELElBQUksSUFDM0JoQyxLQUFLa0MsY0FBZSxFQUNwQmxDLEtBQUttQyxjQUFlLEVBRXBCbkMsS0FBS29DLFFBQ0xwQyxLQUFLcUMsUUFDUCxDQUVBRCxRQUVBLENBRUFDLFNBQ0VDLE9BQU9DLHVCQUFzQixLQUMzQnpDLEVBQTJCMEMsS0FBS3hDLE1BQ2hDQSxLQUFLeUMsV0FDTHpDLEtBQUswQyxzQkFBc0IsR0FFL0IsQ0FFQUMsVUFDTzNDLEtBQUtrQyxjQUtWbEMsS0FBSzRDLGFBQ0w1QyxLQUFLcUMsVUFMSHJDLEtBQUswQyxzQkFNVCxDQUVBQSx1QkFFQSxDQUVBRCxXQUVBLENBRUFHLGFBRUEsQ0FFQXJDLFdBQ0UsTUFBTyxFQUNULENBRUFzQyxhQUFhWixHQUNYQSxFQUFZYSxTQUFRQyxJQUNsQi9DLEtBQUtpQyxZQUFZZSxJQUFJRCxFQUFXLEdBRXBDLENBRUFFLE9BQU9DLEdBQ2UvQyxNQUFNQyxLQUFLSixLQUFLaUMsYUFFeEJhLFNBQVFDLElBQ2xCQSxFQUFXSSxTQUFTRCxHQUNwQkgsRUFBV0osVUFDWEksRUFBV2IsY0FBZSxDQUFLLEdBRW5DLENBRUFpQixTQUFTRCxHQUNQbEQsS0FBS29ELGlCQUFpQkYsR0FFakJsRCxLQUFLbUMsZUFJVm5DLEtBQUtxRCxrQkFBa0JILEdBQ3ZCbEQsS0FBS3NELGFBQWFKLEdBQ2xCbEQsS0FBS2lELE9BQU9DLEdDekZBLEVBQUNLLEVBQWF0QyxLQUM1QixJQUNFdUMsZUFBZUMsUUR5RlAsY0N6Rm9CQyxLQUFLQyxVQUFVMUMsRyxDQUMzQyxNQUFPMkMsR0FDUCxNQUFNLElBQUlDLE1BQU0sZ0IsR0R1RmhCSixDQUFRLEVBQWV6RCxLQUFLOEIsYUFDOUIsQ0FFQXNCLGlCQUFpQkYsR0FDZixNQUFNWSxFQUFlSixLQUFLQyxVQUFVLE9BQUQsVUFBTTNELEtBQUs4QixjQUN4Q2lDLEVBQVlMLEtBQUtDLFVBQVUsT0FBRCx3QkFBTTNELEtBQUs4QixhQUFnQm9CLElBRTNEbEQsS0FBS21DLGFBQWUyQixJQUFpQkMsQ0FDdkMsQ0FFQVYsa0JBQWtCSCxHQUNoQixNQUFNYyxFQUFtQkMsT0FBT0MsS0FBS2hCLEdBQy9CbkIsRUFBaUI1QixNQUFNQyxLQUFLSixLQUFLK0IsZ0JBRWpDb0MsRUFBUUgsRUFBaUJJLFFBQU9iLEdBQU94QixFQUFlc0MsU0FBU2QsS0FDckV2RCxLQUFLa0MsYUFBZ0MsSUFBakJpQyxFQUFNRyxNQUM1QixDQUVBaEIsYUFBYUosR0FDY2UsT0FBT0MsS0FBS2hCLEdBRXBCSixTQUFRUyxJQUN2QixNQUFNZ0IsRUFBV2hCLEVBQ2pCdkQsS0FBSzhCLFlBQVl5QyxHQUFZckIsRUFDM0JxQixFQUM2QixHQUVuQyxFRXJIRixTQUFnQixtQkFBcUIsd0JDR3RCLE1BQU1DLFVBQW9CNUMsRUFHdkNyQixXQUNFLE1BQU0sbUJBQUVrRSxHQUF1QixHQUN6QixRQUFFQyxHQUFZMUUsS0FBSzhCLFlBT3pCLE1BSlMsMkJBQ1cyQyx1REFBd0VDLGNBSTlGLENBRUF0QyxRQUNFLE1BQU0sUUFBRXVDLEdBQVkzRSxLQUFLOEIsWUFFekI5QixLQUFLNEUsWUFBZUMsSUFDbEJGLEVBQVFFLEVBQUVDLE9BQU83RCxNQUFNLEVBR3pCakIsS0FBSytFLFlBQWMsS0FDRi9FLEtBQUtDLEtBQ2IrRSxPQUFPLENBRWxCLENBRUF2QyxXQUNFekMsS0FBS0MsS0FBS2dGLGlCQUFpQixRQUFTakYsS0FBSzRFLGFBQ3pDNUUsS0FBSytFLGFBQ1AsQ0FFQW5DLGFBQ0U1QyxLQUFLQyxLQUFLaUYsb0JBQW9CLFFBQVNsRixLQUFLNEUsWUFDOUMsRUN0Q0YsU0FBZ0IsWUFBYyx1QkFBdUIsU0FBVyx1QkFBdUIsUUFBVSx3QkNHbEYsTUFBTU8sVUFBcUJ2RCxFQUV4Q3JCLFdBQ0UsTUFBTSxjQUFFNkUsRUFBYSxxQkFBRUMsRUFBb0IsU0FBRUMsRUFBUSxRQUFFWixHQUNyRDFFLEtBQUs4QixhQUNELFlBQUV5RCxFQUFXLFNBQUVDLEVBQVEsUUFBRUMsR0FBWSxFQUVyQ0MsRUFBZSxDQUFDQyxFQUFXakIsS0FDL0IsSUFBS2lCLEVBQUt0QixTQUFTSyxHQUNqQixPQUFPaUIsRUFHVCxNQUFNQyxFQUFZRCxFQUFLRSxNQUFNLElBQUlDLE9BQU9wQixFQUFTLE9BQU8sR0FFeEQsT0FBT2lCLEVBQUtJLFFBQ1YsSUFBSUQsT0FBT0YsRUFBVyxNQUN0QixnQkFBZ0JILE1BQVlHLFdBQzdCLEVBcUJILE1BakJTLHdCQUNRUCxFQUF1QkUsRUFBYyxxQkFDNUIsUUFBcEIsRUFBQXBGLE1BQU1DLEtBQUtrRixVQUFTLGVBQ2xCVSxLQUNBLENBQUNMLEVBQU1NLElBQ0wsT0FDRUEsSUFBVWIsRUFBZ0IsU0FBU0ksSUFBYSxrQkFDbENTLDhCQUNOUCxFQUFhQyxFQUFLTyxNQUFPeEIsc0NBQ3ZCZ0IsRUFBYUMsRUFBS1EsT0FBUXpCLHNDQUd6QzBCLEtBQUssNkJBYmEsSSxDQW1CM0IsQ0FFQWhFLFFBQ0UsTUFBTSxRQUFFaUUsR0FBWXJHLEtBQUs4QixZQUV6QjlCLEtBQUtzRyxZQUFlekIsSUFDbEIsTUFDTTBCLEVBRFMxQixFQUFFQyxPQUNFMEIsUUFBUSxNQUMzQixHQUFJRCxFQUFLLENBQ1AsTUFBTSxNQUFFTixHQUFVTSxFQUFJRSxRQUN0QkosRUFBUXJHLEtBQUs4QixZQUFZd0QsU0FBU29CLFNBQVNULElBQVNBLEUsRUFHMUQsQ0FFQXhELFdBQ0V6QyxLQUFLQyxLQUFLZ0YsaUJBQWlCLFFBQVNqRixLQUFLc0csYUFFekMsTUFBTSxjQUFFbEIsR0FBa0JwRixLQUFLOEIsYUFHMUJzRCxFQUFnQixHQUFLQSxHQUFpQixHQUF3QixJQUFsQkEsSUFDL0NwRixLQUFLQyxLQUFLMEcsU0FBUyxFQUFHLEdBR3BCdkIsRUFBZ0IsR0FDbEJwRixLQUFLQyxLQUFLMEcsU0FBUyxFQU5SLE1BTW1CdkIsRUFBZ0IsR0FFbEQsQ0FFQXhDLGFBQ0U1QyxLQUFLQyxLQUFLaUYsb0JBQW9CLFFBQVNsRixLQUFLc0csWUFDOUMsRUMxRUYsU0FBZ0IsVUFBWSx1QkFBdUIsTUFBUSx1QkFBdUIsZUFBaUIsd0JDR3BGLE1BQU1NLFVBQXVCaEYsRUFDMUNyQixXQUNFLE1BQU0sZ0JBQUVzRyxFQUFlLGFBQUVDLEdBQWlCOUcsS0FBSzhCLGFBQ3pDLFVBQUVpRixFQUFTLE1BQUVDLEVBQUssZUFBRUMsR0FBbUIsRUFvQjdDLE1BQU8sb0JBRUxKLEVBbkJPLHlCQUNTRSxzREFFREMsc0dBQzRFRixFQUFhSSxnR0FFcEZELHlCQUNQSCxFQUFhWiwrQkFDYlksRUFBYVgsZ0NBQ2JXLEVBQWFLLDBDQUNQTCxFQUFhTSxvR0FTUyxzQkFHN0MsRUMvQkYsU0FBZ0IsVUFBWSx1QkFBdUIsR0FBSyx3QkNHekMsTUFBTUMsVUFBaUJ6RixFQUNwQ3JCLFdBQ0UsTUFBTSxXQUFFK0csRUFBVSxRQUFFNUMsRUFBTyxxQkFBRVcsR0FBeUJyRixLQUFLOEIsYUFDckQsVUFBRXlGLEdBQWMsRUFJaEJDLEVBQWtCLGtCQUFrQjlDLHNDQTRCMUMsTUFQUyx5QkFDUzZDLGtCQUxORCxFQWRhLElBQW5CNUMsRUFBUUosT0FMTyw4QkFTZkksRUFBUUosT0FBUyxHQUFLSSxFQUFRSixPQUFTLEVBUnpCLHdEQVliZSxHQUF3QlgsRUFBUUosUUFBVSxFQUN0Q2tELE9BRFQsRUFNcUMsNEJBWXpDLEVDcENGLElDUWUsY0FBa0I1RixFQUkvQkMsYUFBWSxLQUFFNUIsSUFXWndILE1BQU0sQ0FBRXhILE9BQU02QixZQVZNLENBQ2xCNEMsUUFBUyxHQUNUVSxjQUFlLEVBQ2ZFLFNBQVUsR0FDVndCLGFBQWMsQ0FBQyxFQUNmekIsc0JBQXNCLEVBQ3RCd0IsaUJBQWlCLEVBQ2pCUyxZQUFZLElBSWhCLENBRUFsRixRQUNFcEMsS0FBS21ELFNBQVMsT0FBRCx3QkFBTW5ELEtBQUs4QixhVnZCWixDQUFDeUIsSUFDZixJQUNFLE1BQU10QyxFQUFRdUMsZUFBZWtFLFFVcUJtQixlVnBCaEQsT0FBT3pHLEVBQVF5QyxLQUFLaUUsTUFBTTFHLEdBQVMsRSxDQUNuQyxNQUFPMkMsR0FDUCxNQUFNLElBQUlDLE1BQU1ELEUsR1VrQndCOEQsS0FDeEMxSCxLQUFLNEgsYUM5Qm1CLEVBQUNDLEVBQVVDLEtBQ3JDLElBQUlDLEVBRUosT0FBT0MsSUFDREQsR0FDRkUsYUFBYUYsR0FHZkEsRUFBVXpGLE9BQU80RixXQUFXTCxFRHlDekIsSUN6QzBDRyxFQUFNLENBQ3BELEVEcUJxQkcsRUFBZ0J6RCxJQUEwQixPLEVBQUEsSyxPQUFBLEUsRUFBQSxZQUU1RCxNQUFNWSxPRWxCTSxDQUFPWixHQUFpQyxvQ0FDdEQsT0FmbUIwQyxFQWVYLDBEQUE4QjFDLElBZlcsT0FBRCw2QkFDbEQsSUFDRSxNQUFNMEQsUUFBaUJDLE1BQU1qQixHQUM3QixJQUFLZ0IsRUFBU0UsR0FDWixNQUFNLElBQUl6RSxNZEhGLG9CY01WLGFBRG1CdUUsRUFBU0csUUFDaEJDLFEsQ0FDWixNQUFPNUUsR0FDUDZFLFFBQVE3RSxNQUFNLGVBQW1DQSxFQUFNOEUsVSxDQUUzRCxJQVhnQixJQUFPdEIsQ0FlNkIsSUZpQnZCdUIsQ0FBbUJqRSxHQUNyQ0EsRUFTSDFFLEtBQUttRCxTQUFTLENBQ1prQyxxQkFBc0JDLEVBQVNoQixPQUFTLEVBQ3hDZ0IsU0FBVUEsRUFDVlosUUFBU0EsRUFDVDRDLGFBQVloQyxFQUFTaEIsT0FBUyxLQVpoQ3RFLEtBQUttRCxTQUFTLENBQ1prQyxzQkFBc0IsRUFDdEJELGNBQWUsRUFDZlYsUUFBUyxHQUNUWSxTQUFVQSxFQUFTaEIsT0FBU2dCLEVBQVcsR0FDdkN3QixhQUFjLENBQUMsR0FVckIsRSxZQW5COEQsSyw2UUFtQjdELElBRUQ5RyxLQUFLNEksZ0JBQW1CL0QsSUFDdEIsTUFBTSxTQUFFUyxFQUFRLGNBQUVGLEdBQWtCcEYsS0FBSzhCLFlBRXpDLEdBQUltQyxPQUFPNEUsT0FBT3RILEdBQVk4QyxTQUFTUSxFQUFFdEIsT0FBUytCLEVBQVNoQixPQUN6RCxPQUdGLE1BQU13RSxFQUFZeEQsRUFBU2hCLE9BQVMsRUFDcEMsSUFBSXlFLEVBQVkzRCxFQUVoQixPQUFRUCxFQUFFdEIsS0FDUixLQUFLaEMsRUFBV0MsUUFDZHVILEVBQThCLElBQWxCM0QsRUFBc0IwRCxFQUFZQyxFQUFZLEVBQzFEL0ksS0FBS21ELFNBQVMsQ0FDWmlDLGNBQWUyRCxJQUVqQixNQUNGLEtBQUt4SCxFQUFXRSxVQUNkc0gsRUFBWTNELElBQWtCMEQsRUFBWSxFQUFJQyxFQUFZLEVBQzFEL0ksS0FBS21ELFNBQVMsQ0FDWmlDLGNBQWUyRCxJQUVqQixNQUNGLEtBQUt4SCxFQUFXRyxNQUNkbUQsRUFBRW1FLGlCQUNGaEosS0FBS21ELFNBQVMsQ0FDWjJELGFBQWN4QixFQUFTRixHQUN2QnlCLGlCQUFpQixJQUVuQixNQUNGLEtBQUt0RixFQUFXSSxPQUNkM0IsS0FBS21ELFNBQVMsQ0FDWjBELGlCQUFpQixJLEVBTXpCN0csS0FBS3NHLFlBQWV6QixJQUNsQixNQUFNQyxFQUFTRCxFQUFFQyxRQUNiQSxFQUFPMEIsUUFBUSxXQUFhMUIsRUFBTzlELFVBQVVpSSxTQUFTLGVBQ3hEakosS0FBS21ELFNBQVMsQ0FDWjBELGlCQUFpQixHLENBSXpCLENBRUF0RyxXQUNFLE1BQU8scVVBV1QsQ0FFQW1DLHVCQUNFLE1BQU0sUUFDSmdDLEVBQU8sY0FDUFUsRUFBYSxTQUNiRSxFQUFRLHFCQUNSRCxFQUFvQixhQUNwQnlCLEVBQVksZ0JBQ1pELEVBQWUsV0FDZlMsR0FDRXRILEtBQUs4QixZQUVULElBQUkwQyxFQUFZLENBQ2R2RSxLQUFNUixFQUFTTyxLQUFLQyxLQUFNLGVBQzFCNkIsWUFBYSxDQUNYNEMsUUFBUzFFLEtBQUs4QixZQUFZNEMsUUFDMUJDLFFBQVMzRSxLQUFLNEgsZ0JBSWxCLE1BQU1zQixFQUFXLElBQUk3QixFQUFTLENBQzVCcEgsS0FBTVIsRUFBU08sS0FBS0MsS0FBTSxnQkFDMUI4QixlQUFnQixDQUFDLGVBQWdCLGlCQUNqQ0QsWUFBYSxDQUFFd0YsYUFBWTVDLFVBQVNXLDBCQUdoQzhELEVBQWUsSUFBSWhFLEVBQWEsQ0FDcENsRixLQUFNUixFQUFTTyxLQUFLQyxLQUFNLG9CQUMxQjZCLFlBQWEsQ0FDWDRDLFVBQ0FZLFdBQ0FELHVCQUNBRCxnQkFDQWlCLFFBQVMsQ0FBQ1MsRUFBcUJiLEtBQzdCakcsS0FBS21ELFNBQVMsQ0FDWjJELGFBQWNBLEVBQ2RELGlCQUFpQixFQUNqQnpCLGNBQWVnRSxPQUFPbkQsSUFDdEIsS0FLRm9ELEVBQWlCLElBQUl6QyxFQUFlLENBQ3hDM0csS0FBTVIsRUFBU08sS0FBS0MsS0FBTSxrQkFDMUI2QixZQUFhLENBQ1hnRixlQUNBRCxxQkFJSjdHLEtBQUs2QyxVQUFVc0csR0FDZm5KLEtBQUs2QyxVQUFVd0csR0FDZnJKLEtBQUs2QyxVQUFVcUcsRUFDakIsQ0FFQXpHLFdBQ0VILE9BQU8yQyxpQkFBaUIsUUFBU2pGLEtBQUs0SSxpQkFDdEM1SSxLQUFLQyxLQUFLZ0YsaUJBQWlCLFFBQVNqRixLQUFLc0csWUFDM0MsQ0FFQTFELGFBQ0VOLE9BQU80QyxvQkFBb0IsUUFBU2xGLEtBQUs0SSxpQkFDekM1SSxLQUFLQyxLQUFLaUYsb0JBQW9CLFFBQVNsRixLQUFLc0csWUFDOUMsR0Q5S00sQ0FBRXJHLEtBQU1SLEVBQVNFLFNBQVUsU0FBVW1DLFlBQWEsTSIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy91dGlscy9kb20vaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbnN0YW50cy9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9jb3JlL0NvbXBvbmVudC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvdXRpbHMvc3RvcmFnZS9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9zZWFyY2gvU2VhcmNoSW5wdXQvU2VhcmNoSW5wdXQubW9kdWxlLnNjc3M/MTQ3MSIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9zZWFyY2gvU2VhcmNoSW5wdXQvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvc2VhcmNoL1NlYXJjaFJlc3VsdC9TZWFyY2hSZXN1bHQubW9kdWxlLnNjc3M/MWFiOSIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9zZWFyY2gvU2VhcmNoUmVzdWx0L2luZGV4LnRzIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy9jb21wb25lbnRzL3NlYXJjaC9TZWFyY2hJdGVtSW5mby9TZWFyY2hJdGVtSW5mby5tb2R1bGUuc2Nzcz8xMWEyIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy9jb21wb25lbnRzL3NlYXJjaC9TZWFyY2hJdGVtSW5mby9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvY29tcG9uZW50cy9tZXNzYWdlL0Vycm9yTWVnL0Vycm9yTWVnLm1vZHVsZS5zY3NzPzBhM2YiLCJ3ZWJwYWNrOi8vd2VidG9vbnMtc2VhcmNoLy4vc3JjL2NvbXBvbmVudHMvbWVzc2FnZS9FcnJvck1lZy9pbmRleC50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly93ZWJ0b29ucy1zZWFyY2gvLi9zcmMvQXBwLnRzIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy91dGlscy9oZWxwZXJzL2luZGV4LnRzIiwid2VicGFjazovL3dlYnRvb25zLXNlYXJjaC8uL3NyYy9hcGkvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBJU2VsZWN0VHlwZSB9IGZyb20gJy4vdHlwZSdcblxuY29uc3Qgc2VsZWN0RWwgPSAoXG4gIHNjb3BlOiBFbGVtZW50IHwgRG9jdW1lbnQgPSBkb2N1bWVudCxcbiAgc2VsZWN0b3I6IHN0cmluZ1xuKTogRWxlbWVudCA9PiB7XG4gIHJldHVybiBzY29wZS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKVxufVxuXG5jb25zdCBzZWxlY3RBbGwgPSAoeyBzY29wZSwgc2VsZWN0b3IgfTogSVNlbGVjdFR5cGUpOiBFbGVtZW50W10gPT4ge1xuICByZXR1cm4gQXJyYXkuZnJvbShzY29wZS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSlcbn1cblxuY29uc3QgY3JlYXRlRWwgPSAodGFnTmFtZTogc3RyaW5nKTogRWxlbWVudCA9PiB7XG4gIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpXG59XG5cbmZ1bmN0aW9uIENvbnZlcnRUZW1wbGF0ZVRvQ29tcG9uZW50KHRoaXM6IGFueSk6IHZvaWQge1xuICBjb25zdCBvbGROb2RlID0gdGhpcy5ub2RlXG4gIGNvbnN0IGNvbXBvbmVudENoaWxkcmVuID0gQXJyYXkuZnJvbShcbiAgICBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHRoaXMudGVtcGxhdGUoKSwgJ3RleHQvaHRtbCcpLmJvZHkuY2hpbGRyZW5cbiAgKVxuICBjb25zdCBjb21wb25lbnQgPSBuZXcgRG9jdW1lbnRGcmFnbWVudCgpXG4gIGNvbXBvbmVudC5hcHBlbmQoLi4uY29tcG9uZW50Q2hpbGRyZW4pXG5cbiAgb2xkTm9kZS5hZnRlcihjb21wb25lbnQpXG4gIHRoaXMubm9kZSA9IG9sZE5vZGUubmV4dFNpYmxpbmdcblxuICBjb25zdCBvbGRDU1MgPSBvbGROb2RlLmNsYXNzTGlzdC52YWx1ZS50cmltKClcbiAgY29uc3QgbmV3Q1NTID0gdGhpcy5ub2RlLmNsYXNzTGlzdC52YWx1ZS50cmltKClcbiAgY29uc3QgaXNDaGFuZ2VkQ1NTID0gb2xkQ1NTICE9PSBuZXdDU1NcbiAgY29uc3QgY3NzVmFsdWUgPSBpc0NoYW5nZWRDU1MgPyBuZXdDU1MgfHwgb2xkQ1NTIDogb2xkQ1NTXG5cbiAgaWYgKCFjc3NWYWx1ZSkge1xuICAgIG9sZE5vZGUucmVtb3ZlKClcbiAgICByZXR1cm5cbiAgfVxuXG4gIHRoaXMubm9kZS5jbGFzc05hbWUgPSBjc3NWYWx1ZVxuXG4gIG9sZE5vZGUucmVtb3ZlKClcbn1cblxuZXhwb3J0IHsgY3JlYXRlRWwsIHNlbGVjdEVsLCBzZWxlY3RBbGwsIENvbnZlcnRUZW1wbGF0ZVRvQ29tcG9uZW50IH1cbiIsIi8qKiBhcGkgKi9cbmNvbnN0IEJBU0VfVVJMID0gJ2h0dHBzOi8va29yZWEtd2VidG9vbi1hcGkuaGVyb2t1YXBwLmNvbSdcbmNvbnN0IFJFUVVTRVRfTUVTU0FHRSA9IHtcbiAgSFRUUF9FUlJPUjogJ+yEnOuyhOyZgOydmCDsl7DqsrDsnbQg67aI7JWI7KCV7ZWp64uI64ukIScsXG4gIFNFUlZFUl9FUlJPUjogJ+yXkOufrOqwgCDrsJzsg53tlojsirXri4jri6QhJ1xufVxuXG4vKiogYWN0aW9ua2V5cyB0eXBlICovXG5jb25zdCBBQ1RJT05LRVlTID0ge1xuICBBUlJPV1VQOiAnQXJyb3dVcCcsXG4gIEFSUk9XRE9XTjogJ0Fycm93RG93bicsXG4gIEVOVEVSOiAnRW50ZXInLFxuICBFU0NBUEU6ICdFc2NhcGUnXG59XG5cbmV4cG9ydCB7IEJBU0VfVVJMLCBSRVFVU0VUX01FU1NBR0UsIEFDVElPTktFWVMgfVxuIiwiaW1wb3J0IHR5cGUgeyBJQ29tcG9uZW50UHJvcHMgfSBmcm9tICdAbW9kZWxzJ1xuaW1wb3J0IHsgQ29udmVydFRlbXBsYXRlVG9Db21wb25lbnQsIHNldEl0ZW0gfSBmcm9tICdAdXRpbHMnXG5cbmV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIENvbXBvbmVudDxTdGF0ZVR5cGU+IHtcbiAgbm9kZTogRWxlbWVudFxuICBpbml0YWxTdGF0ZTogU3RhdGVUeXBlXG4gIHJlbmRlclN0YXRlS2V5OiBTZXQ8c3RyaW5nPlxuICBzdWJzY3JpYmVyczogU2V0PGFueT5cbiAgaXNOZWVkUmVuZGVyOiBib29sZWFuXG4gIGlzTmVlZFVwZGF0ZTogYm9vbGVhblxuICBjb25zdHJ1Y3Rvcih7XG4gICAgbm9kZSxcbiAgICBpbml0YWxTdGF0ZSxcbiAgICByZW5kZXJTdGF0ZUtleSA9IFtdXG4gIH06IElDb21wb25lbnRQcm9wczxTdGF0ZVR5cGU+KSB7XG4gICAgdGhpcy5ub2RlID0gbm9kZVxuICAgIHRoaXMuaW5pdGFsU3RhdGUgPSBpbml0YWxTdGF0ZVxuICAgIHRoaXMucmVuZGVyU3RhdGVLZXkgPSBuZXcgU2V0KHJlbmRlclN0YXRlS2V5KVxuICAgIHRoaXMuc3Vic2NyaWJlcnMgPSBuZXcgU2V0KFtdKVxuICAgIHRoaXMuaXNOZWVkUmVuZGVyID0gZmFsc2VcbiAgICB0aGlzLmlzTmVlZFVwZGF0ZSA9IGZhbHNlXG5cbiAgICB0aGlzLnNldHVwKClcbiAgICB0aGlzLnJlbmRlcigpXG4gIH1cblxuICBzZXR1cCgpOiB2b2lkIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIHJlbmRlcigpOiB2b2lkIHtcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgIENvbnZlcnRUZW1wbGF0ZVRvQ29tcG9uZW50LmNhbGwodGhpcylcbiAgICAgIHRoaXMuc2V0RXZlbnQoKVxuICAgICAgdGhpcy5yZW5kZXJDaGlsZENvbXBvbmVudCgpXG4gICAgfSlcbiAgfVxuXG4gIHVwZGF0ZXIoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzTmVlZFJlbmRlcikge1xuICAgICAgdGhpcy5yZW5kZXJDaGlsZENvbXBvbmVudCgpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0aGlzLmNsZWFyRXZlbnQoKVxuICAgIHRoaXMucmVuZGVyKClcbiAgfVxuXG4gIHJlbmRlckNoaWxkQ29tcG9uZW50KCk6IHZvaWQge1xuICAgIHJldHVyblxuICB9XG5cbiAgc2V0RXZlbnQoKTogdm9pZCB7XG4gICAgcmV0dXJuXG4gIH1cblxuICBjbGVhckV2ZW50KCk6IHZvaWQge1xuICAgIHJldHVyblxuICB9XG5cbiAgdGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gJydcbiAgfVxuXG4gIHN1YnNjcmliZSguLi5zdWJzY3JpYmVyczogYW55W10pOiB2b2lkIHtcbiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKHN1YnNjcmliZXIgPT4ge1xuICAgICAgdGhpcy5zdWJzY3JpYmVycy5hZGQoc3Vic2NyaWJlcilcbiAgICB9KVxuICB9XG5cbiAgbm90aWZ5KG5ld1N0YXRlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBzdWJzY3JpYmVycyA9IEFycmF5LmZyb20odGhpcy5zdWJzY3JpYmVycylcblxuICAgIHN1YnNjcmliZXJzLmZvckVhY2goc3Vic2NyaWJlciA9PiB7XG4gICAgICBzdWJzY3JpYmVyLnNldFN0YXRlKG5ld1N0YXRlKVxuICAgICAgc3Vic2NyaWJlci51cGRhdGVyKClcbiAgICAgIHN1YnNjcmliZXIuaXNOZWVkUmVuZGVyID0gZmFsc2VcbiAgICB9KVxuICB9XG5cbiAgc2V0U3RhdGUobmV3U3RhdGU6IGFueSk6IHZvaWQge1xuICAgIHRoaXMuY2hlY2tVcGRhdGFTdGF0ZShuZXdTdGF0ZSlcblxuICAgIGlmICghdGhpcy5pc05lZWRVcGRhdGUpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMucmVmbGVjdE5lZWRSZW5kZXIobmV3U3RhdGUpXG4gICAgdGhpcy5yZWZsZWN0U3RhdGUobmV3U3RhdGUpXG4gICAgdGhpcy5ub3RpZnkobmV3U3RhdGUpXG5cbiAgICBzZXRJdGVtKCdzZWFyY2hTdGF0ZScsIHRoaXMuaW5pdGFsU3RhdGUpXG4gIH1cblxuICBjaGVja1VwZGF0YVN0YXRlKG5ld1N0YXRlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBjdXJyZW50U3RhdGUgPSBKU09OLnN0cmluZ2lmeSh7IC4uLnRoaXMuaW5pdGFsU3RhdGUgfSlcbiAgICBjb25zdCBuZXh0U3RhdGUgPSBKU09OLnN0cmluZ2lmeSh7IC4uLnRoaXMuaW5pdGFsU3RhdGUsIC4uLm5ld1N0YXRlIH0pXG5cbiAgICB0aGlzLmlzTmVlZFVwZGF0ZSA9IGN1cnJlbnRTdGF0ZSAhPT0gbmV4dFN0YXRlXG4gIH1cblxuICByZWZsZWN0TmVlZFJlbmRlcihuZXdTdGF0ZTogYW55KTogdm9pZCB7XG4gICAgY29uc3QgdXBkYXRlZFN0YXRlS2V5cyA9IE9iamVjdC5rZXlzKG5ld1N0YXRlKVxuICAgIGNvbnN0IHJlbmRlclN0YXRlS2V5ID0gQXJyYXkuZnJvbSh0aGlzLnJlbmRlclN0YXRlS2V5KVxuXG4gICAgY29uc3Qgc3RhdGUgPSB1cGRhdGVkU3RhdGVLZXlzLmZpbHRlcihrZXkgPT4gcmVuZGVyU3RhdGVLZXkuaW5jbHVkZXMoa2V5KSlcbiAgICB0aGlzLmlzTmVlZFJlbmRlciA9IHN0YXRlLmxlbmd0aCA9PT0gMFxuICB9XG5cbiAgcmVmbGVjdFN0YXRlKG5ld1N0YXRlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCB1cGRhdGVkU3RhdGVLZXlzID0gT2JqZWN0LmtleXMobmV3U3RhdGUpXG5cbiAgICB1cGRhdGVkU3RhdGVLZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlS2V5ID0ga2V5IGFzIGtleW9mIFN0YXRlVHlwZVxuICAgICAgdGhpcy5pbml0YWxTdGF0ZVtzdGF0ZUtleV0gPSBuZXdTdGF0ZVtcbiAgICAgICAgc3RhdGVLZXlcbiAgICAgIF0gYXMgU3RhdGVUeXBlW2tleW9mIFN0YXRlVHlwZV1cbiAgICB9KVxuICB9XG59XG4iLCJjb25zdCBzZXRJdGVtID0gKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogdm9pZCA9PiB7XG4gIHRyeSB7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYOyggOyepeydtCDrkJjsp4Ag7JWK7JWY7Iq164uI64ukIWApXG4gIH1cbn1cblxuY29uc3QgZ2V0SXRlbSA9IChrZXk6IHN0cmluZyk6IGFueSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdmFsdWUgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleSlcbiAgICByZXR1cm4gdmFsdWUgPyBKU09OLnBhcnNlKHZhbHVlKSA6IFtdXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGVycm9yKVxuICB9XG59XG5cbmV4cG9ydCB7IHNldEl0ZW0sIGdldEl0ZW0gfVxuIiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQgZGVmYXVsdCB7XCJTZWFyY2hJbnB1dF9faW5wdXRcIjpcIm9aRmRTOEFNalI1Uk1ZeUJOdktWXCJ9OyIsImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0Bjb21wb25lbnRzJ1xuaW1wb3J0IHN0eWxlcyBmcm9tICcuL1NlYXJjaElucHV0Lm1vZHVsZS5zY3NzJ1xuaW1wb3J0IHR5cGUgeyBJU2VhcmNoSW5wdXRTdGF0ZSB9IGZyb20gJy4vdHlwZSdcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VhcmNoSW5wdXQgZXh0ZW5kcyBDb21wb25lbnQ8SVNlYXJjaElucHV0U3RhdGU+IHtcbiAgaGFuZGxlSW5wdXQ6IChlOiBhbnkpID0+IHZvaWRcbiAgaGFuZGxlRm9jdXM6ICgpID0+IHZvaWRcbiAgdGVtcGxhdGUoKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IFNlYXJjaElucHV0X19pbnB1dCB9ID0gc3R5bGVzXG4gICAgY29uc3QgeyBrZXl3b3JkIH0gPSB0aGlzLmluaXRhbFN0YXRlXG5cbiAgICBjb25zdCBzZWFyY2hJbnB1dFZpZXcgPSAoKTogc3RyaW5nID0+IHtcbiAgICAgIHJldHVybiBgXG4gICAgICAgIDxpbnB1dCBjbGFzcz0nJHtTZWFyY2hJbnB1dF9faW5wdXR9JyB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0n7Ju57Yiw7KCc66qpLCDsnpHqsIDsnbTrpoTsnLzroZwg6rKA7IOJJyB2YWx1ZT0nJHtrZXl3b3JkfScvPlxuICAgICAgYFxuICAgIH1cbiAgICByZXR1cm4gc2VhcmNoSW5wdXRWaWV3KClcbiAgfVxuXG4gIHNldHVwKCk6IHZvaWQge1xuICAgIGNvbnN0IHsgb25JbnB1dCB9ID0gdGhpcy5pbml0YWxTdGF0ZVxuXG4gICAgdGhpcy5oYW5kbGVJbnB1dCA9IChlKTogdm9pZCA9PiB7XG4gICAgICBvbklucHV0KGUudGFyZ2V0LnZhbHVlKVxuICAgIH1cblxuICAgIHRoaXMuaGFuZGxlRm9jdXMgPSAoKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCAkaW5wdXQgPSB0aGlzLm5vZGUgYXMgSFRNTElucHV0RWxlbWVudFxuICAgICAgJGlucHV0LmZvY3VzKClcbiAgICB9XG4gIH1cblxuICBzZXRFdmVudCgpOiB2b2lkIHtcbiAgICB0aGlzLm5vZGUuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB0aGlzLmhhbmRsZUlucHV0KVxuICAgIHRoaXMuaGFuZGxlRm9jdXMoKVxuICB9XG5cbiAgY2xlYXJFdmVudCgpOiB2b2lkIHtcbiAgICB0aGlzLm5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB0aGlzLmhhbmRsZUlucHV0KVxuICB9XG59XG4iLCIvLyBleHRyYWN0ZWQgYnkgbWluaS1jc3MtZXh0cmFjdC1wbHVnaW5cbmV4cG9ydCBkZWZhdWx0IHtcInJlc3VsdF9saXN0XCI6XCJoakNkY28yN2xKSlRvMm95Uk41d1wiLFwic2VsZWN0ZWRcIjpcInlxQnFXeGlSOUFTdEdCNThyTGZTXCIsXCJtYXRjaGVkXCI6XCJPQWY1SndrRDlvU09KV3BsV0tfMFwifTsiLCJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAY29tcG9uZW50cydcbmltcG9ydCBzdHlsZXMgZnJvbSAnLi9TZWFyY2hSZXN1bHQubW9kdWxlLnNjc3MnXG5pbXBvcnQgdHlwZSB7IElTZWFyY2hSZXN1bHRTdGF0ZSB9IGZyb20gJy4vdHlwZSdcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VhcmNoUmVzdWx0IGV4dGVuZHMgQ29tcG9uZW50PElTZWFyY2hSZXN1bHRTdGF0ZT4ge1xuICBoYW5kbGVDbGljazogKGU6IGFueSkgPT4gdm9pZFxuICB0ZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHsgc2VsZWN0ZWRJbmRleCwgaXNSZXN1bHRMaXN0VmlzaWFibGUsIGxpc3REYXRhLCBrZXl3b3JkIH0gPVxuICAgICAgdGhpcy5pbml0YWxTdGF0ZVxuICAgIGNvbnN0IHsgcmVzdWx0X2xpc3QsIHNlbGVjdGVkLCBtYXRjaGVkIH0gPSBzdHlsZXNcblxuICAgIGNvbnN0IG1hdGNoS2V5d29yZCA9IChpdGVtOiBhbnksIGtleXdvcmQ6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgICBpZiAoIWl0ZW0uaW5jbHVkZXMoa2V5d29yZCkpIHtcbiAgICAgICAgcmV0dXJuIGl0ZW1cbiAgICAgIH1cblxuICAgICAgY29uc3QgbWF0Y2hUZXh0ID0gaXRlbS5tYXRjaChuZXcgUmVnRXhwKGtleXdvcmQsICdnaScpKVswXVxuXG4gICAgICByZXR1cm4gaXRlbS5yZXBsYWNlKFxuICAgICAgICBuZXcgUmVnRXhwKG1hdGNoVGV4dCwgJ2dpJyksXG4gICAgICAgIGA8c3BhbiBjbGFzcz0nJHttYXRjaGVkfSc+JHttYXRjaFRleHR9PC9zcGFuPmBcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBzZWFyY2hSZXN1bHRWaWV3ID0gKCk6IHN0cmluZyA9PiB7XG4gICAgICByZXR1cm4gYFxuICAgICAgICA8dWwgY2xhc3M9JyR7aXNSZXN1bHRMaXN0VmlzaWFibGUgPyByZXN1bHRfbGlzdCA6ICdoaWRlJ30nPlxuICAgICAgICAke0FycmF5LmZyb20obGlzdERhdGEpXG4gICAgICAgICAgPy5tYXAoXG4gICAgICAgICAgICAoaXRlbSwgaW5kZXgpID0+XG4gICAgICAgICAgICAgIGA8bGkgJHtcbiAgICAgICAgICAgICAgICBpbmRleCA9PT0gc2VsZWN0ZWRJbmRleCA/IGBjbGFzcz0ke3NlbGVjdGVkfWAgOiAnJ1xuICAgICAgICAgICAgICB9IGRhdGEtaW5kZXg9JyR7aW5kZXh9Jz5cbiAgICAgICAgICAgICAgICA8c3Bhbj4ke21hdGNoS2V5d29yZChpdGVtLnRpdGxlLCBrZXl3b3JkKX08L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4+WyAke21hdGNoS2V5d29yZChpdGVtLmF1dGhvciwga2V5d29yZCl9IF0gPC9zcGFuPlxuICAgICAgICAgICAgICA8L2xpPmBcbiAgICAgICAgICApXG4gICAgICAgICAgLmpvaW4oJycpfVxuICAgICAgICA8L3VsPlxuICAgICAgYFxuICAgIH1cblxuICAgIHJldHVybiBzZWFyY2hSZXN1bHRWaWV3KClcbiAgfVxuXG4gIHNldHVwKCk6IHZvaWQge1xuICAgIGNvbnN0IHsgb25DbGljayB9ID0gdGhpcy5pbml0YWxTdGF0ZVxuXG4gICAgdGhpcy5oYW5kbGVDbGljayA9IChlKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudFxuICAgICAgY29uc3QgJGxpID0gdGFyZ2V0LmNsb3Nlc3QoJ2xpJylcbiAgICAgIGlmICgkbGkpIHtcbiAgICAgICAgY29uc3QgeyBpbmRleCB9ID0gJGxpLmRhdGFzZXRcbiAgICAgICAgb25DbGljayh0aGlzLmluaXRhbFN0YXRlLmxpc3REYXRhW3BhcnNlSW50KGluZGV4KV0sIGluZGV4KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50KCk6IHZvaWQge1xuICAgIHRoaXMubm9kZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlQ2xpY2spXG5cbiAgICBjb25zdCB7IHNlbGVjdGVkSW5kZXggfSA9IHRoaXMuaW5pdGFsU3RhdGVcblxuICAgIGNvbnN0IHRlbXAgPSA0MC41IC8vbGkgc2l6ZVxuICAgIGlmICgoc2VsZWN0ZWRJbmRleCA+IDAgJiYgc2VsZWN0ZWRJbmRleCA8PSAzKSB8fCBzZWxlY3RlZEluZGV4ID09PSAwKSB7XG4gICAgICB0aGlzLm5vZGUuc2Nyb2xsVG8oMCwgMClcbiAgICB9XG5cbiAgICBpZiAoc2VsZWN0ZWRJbmRleCA+IDMpIHtcbiAgICAgIHRoaXMubm9kZS5zY3JvbGxUbygwLCB0ZW1wICogKHNlbGVjdGVkSW5kZXggLSAzKSlcbiAgICB9XG4gIH1cblxuICBjbGVhckV2ZW50KCk6IHZvaWQge1xuICAgIHRoaXMubm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlQ2xpY2spXG4gIH1cbn1cbiIsIi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpblxuZXhwb3J0IGRlZmF1bHQge1wiaXRlbV9pbmZvXCI6XCJiX0JpRVFDYVdOME40Z3JRTm9SX1wiLFwibW9kYWxcIjpcImZWd1pjWGlOVHpfYjZqQ3k4TXVaXCIsXCJpbmZvX3RleHRfY29udFwiOlwiVEJlX0Qwbm9UUTFBWFF2dHFJYTJcIn07IiwiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGNvbXBvbmVudHMnXG5pbXBvcnQgc3R5bGVzIGZyb20gJy4vU2VhcmNoSXRlbUluZm8ubW9kdWxlLnNjc3MnXG5pbXBvcnQgdHlwZSB7IElTZWFyY2hJdGVtSW5mb1N0YXRlIH0gZnJvbSAnLi90eXBlJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWFyY2hJdGVtSW5mbyBleHRlbmRzIENvbXBvbmVudDxJU2VhcmNoSXRlbUluZm9TdGF0ZT4ge1xuICB0ZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHsgaXNNb2RhbFZpc2lhYmxlLCBzZWxlY3RlZEl0ZW0gfSA9IHRoaXMuaW5pdGFsU3RhdGVcbiAgICBjb25zdCB7IGl0ZW1faW5mbywgbW9kYWwsIGluZm9fdGV4dF9jb250IH0gPSBzdHlsZXNcblxuICAgIGNvbnN0IHNlYXJjaEl0ZW1JbmZvVmlldyA9ICgpOiBzdHJpbmcgPT4ge1xuICAgICAgcmV0dXJuIGBcbiAgICAgICAgPGRpdiBjbGFzcz0nJHtpdGVtX2luZm99IGl0ZW1faW5mbycgPlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGNsYXNzPScke21vZGFsfSdcbiAgICAgICAgICAgIHN0eWxlPSdiYWNrZ3JvdW5kLWltYWdlOmxpbmVhci1ncmFkaWVudChyZ2JhKDAsIDAsIDAsIDAuNSksIHJnYmEoMCwgMCwgMCwgMSkpLCB1cmwoJHtzZWxlY3RlZEl0ZW0uaW1nfSk7Jz5cbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPmNhbmNlbDwvYnV0dG9uPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz0nJHtpbmZvX3RleHRfY29udH0nPlxuICAgICAgICAgICAgICA8cD4ke3NlbGVjdGVkSXRlbS50aXRsZX08L3A+XG4gICAgICAgICAgICAgIDxwPiR7c2VsZWN0ZWRJdGVtLmF1dGhvcn08L3A+XG4gICAgICAgICAgICAgIDxwPiR7c2VsZWN0ZWRJdGVtLnNlcnZpY2V9IOyXsOyerDwvcD5cbiAgICAgICAgICAgICAgPGEgaHJlZj0nJHtzZWxlY3RlZEl0ZW0udXJsfScgdGFyZ2V0PSdfYmxhbmsnPuuztOufrOqwgOq4sDwvYT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj4gICAgICBcbiAgICAgIGBcbiAgICB9XG5cbiAgICByZXR1cm4gYFxuICAgIDxkaXY+XG4gICAgJHtpc01vZGFsVmlzaWFibGUgPyBzZWFyY2hJdGVtSW5mb1ZpZXcoKSA6ICcnfVxuICAgIDwvZGl2PlxuICAgIGBcbiAgfVxufVxuIiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQgZGVmYXVsdCB7XCJlcnJvcl9tZWdcIjpcIm1hd0w1allQYmxtWHhjd0o3ZjNYXCIsXCJ1cFwiOlwiRUE1S2ZZU0psU0E1TGpnM1d5bnNcIn07IiwiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGNvbXBvbmVudHMnXG5pbXBvcnQgc3R5bGVzIGZyb20gJy4vRXJyb3JNZWcubW9kdWxlLnNjc3MnXG5pbXBvcnQgdHlwZSB7IElFcnJvck1lZ1N0YXRlIH0gZnJvbSAnLi90eXBlJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFcnJvck1lZyBleHRlbmRzIENvbXBvbmVudDxJRXJyb3JNZWdTdGF0ZT4ge1xuICB0ZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHsgaXNFcnJvck1lZywga2V5d29yZCwgaXNSZXN1bHRMaXN0VmlzaWFibGUgfSA9IHRoaXMuaW5pdGFsU3RhdGVcbiAgICBjb25zdCB7IGVycm9yX21lZyB9ID0gc3R5bGVzXG5cbiAgICBjb25zdCBrZXl3b3JkRXJyb3IgPSBgPHNwYW4+6rKA7IOJ7Ja066W8IOyeheugpe2VtOyjvOyEuOyalCA6KTwvc3Bhbj5gXG4gICAgY29uc3QgbGVuZ3RoRXJyb3IgPSBgPHNwYW4+PHN0cm9uZz4n65GQIOq4gOyekCc8L3N0cm9uZz4g67aA7YSwIOqygOyDieydtCDqsIDriqXtlanri4jri6QgOik8L3NwYW4+YFxuICAgIGNvbnN0IG5vbmVSZXN1bHRFcnJvciA9IGA8c3Bhbj48c3Ryb25nPicke2tleXdvcmR9Jzwvc3Ryb25nPiDsnZgg6rKA7IOJIOqysOqzvOqwgCDsl4bsirXri4jri6QgOig8L3NwYW4+YFxuXG4gICAgY29uc3QgRXJyb3JUeXBlID0gKCk6IHN0cmluZyA9PiB7XG4gICAgICBpZiAoa2V5d29yZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGtleXdvcmRFcnJvclxuICAgICAgfVxuXG4gICAgICBpZiAoa2V5d29yZC5sZW5ndGggPCAyICYmIGtleXdvcmQubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gbGVuZ3RoRXJyb3JcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc1Jlc3VsdExpc3RWaXNpYWJsZSAmJiBrZXl3b3JkLmxlbmd0aCA+PSAyKSB7XG4gICAgICAgIHJldHVybiBub25lUmVzdWx0RXJyb3JcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBFcnJvck1lc3NhZ2VTaG93ID0gKCk6IHN0cmluZyA9PiB7XG4gICAgICByZXR1cm4gYCR7aXNFcnJvck1lZyA/IEVycm9yVHlwZSgpIDogJyd9YFxuICAgIH1cblxuICAgIGNvbnN0IEVycm9yTWVnVmlldyA9ICgpOiBzdHJpbmcgPT4ge1xuICAgICAgcmV0dXJuIGBcbiAgICAgICAgPGRpdiBjbGFzcz0nJHtlcnJvcl9tZWd9Jz5cbiAgICAgICAgICAke0Vycm9yTWVzc2FnZVNob3coKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICBgXG4gICAgfVxuXG4gICAgcmV0dXJuIEVycm9yTWVnVmlldygpXG4gIH1cbn1cbiIsImltcG9ydCB7IHNlbGVjdEVsIH0gZnJvbSAnQHV0aWxzJ1xuaW1wb3J0IEFwcCBmcm9tICdBcHAnXG5pbXBvcnQgJy4vc2Nzcy9pbmRleC5zY3NzJ1xuXG5uZXcgQXBwKHsgbm9kZTogc2VsZWN0RWwoZG9jdW1lbnQsICcjcm9vdCcpLCBpbml0YWxTdGF0ZTogbnVsbCB9KVxuIiwiaW1wb3J0IHsgYXBpIH0gZnJvbSAnQGFwaSdcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgU2VhcmNoSW5wdXQsXG4gIFNlYXJjaFJlc3VsdCxcbiAgU2VhcmNoSXRlbUluZm8sXG4gIEVycm9yTWVnXG59IGZyb20gJ0Bjb21wb25lbnRzJ1xuaW1wb3J0IHsgQUNUSU9OS0VZUyB9IGZyb20gJ0Bjb25zdGFudHMnXG5pbXBvcnQgdHlwZSB7IElDb21wb25lbnRQcm9wcywgSUl0ZW0sIElBcHBTdGF0ZSB9IGZyb20gJ0Btb2RlbHMnXG5pbXBvcnQgeyBkZWJvdW5jZSwgc2VsZWN0RWwsIGdldEl0ZW0gfSBmcm9tICdAdXRpbHMnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwcCBleHRlbmRzIENvbXBvbmVudDxJQXBwU3RhdGU+IHtcbiAgaGFuZGxlQ2hhbmdlOiAoa2V5d29yZDogc3RyaW5nKSA9PiB2b2lkXG4gIGhhbmRsZUtleUNoYW5nZTogKGU6IEtleWJvYXJkRXZlbnQpID0+IHZvaWRcbiAgaGFuZGxlQ2xpY2s6IChlOiBNb3VzZUV2ZW50KSA9PiB2b2lkXG4gIGNvbnN0cnVjdG9yKHsgbm9kZSB9OiBJQ29tcG9uZW50UHJvcHM8SUFwcFN0YXRlPikge1xuICAgIGNvbnN0IGluaXRhbFN0YXRlID0ge1xuICAgICAga2V5d29yZDogJycsXG4gICAgICBzZWxlY3RlZEluZGV4OiAwLFxuICAgICAgbGlzdERhdGE6IFtdLFxuICAgICAgc2VsZWN0ZWRJdGVtOiB7fSxcbiAgICAgIGlzUmVzdWx0TGlzdFZpc2lhYmxlOiBmYWxzZSxcbiAgICAgIGlzTW9kYWxWaXNpYWJsZTogZmFsc2UsXG4gICAgICBpc0Vycm9yTWVnOiB0cnVlXG4gICAgfSBhcyBJQXBwU3RhdGVcblxuICAgIHN1cGVyKHsgbm9kZSwgaW5pdGFsU3RhdGUgfSlcbiAgfVxuXG4gIHNldHVwKCk6IHZvaWQge1xuICAgIHRoaXMuc2V0U3RhdGUoeyAuLi50aGlzLmluaXRhbFN0YXRlLCAuLi5nZXRJdGVtKCdzZWFyY2hTdGF0ZScpIH0pXG4gICAgdGhpcy5oYW5kbGVDaGFuZ2UgPSBkZWJvdW5jZShhc3luYyAoa2V5d29yZCk6IFByb21pc2U8YW55PiA9PiB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWNvbmZ1c2luZy12b2lkLWV4cHJlc3Npb25cbiAgICAgIGNvbnN0IGxpc3REYXRhID0gYXdhaXQgYXBpLmdldFdlYlRvb25MaXN0KGtleXdvcmQpXG4gICAgICBpZiAoIWtleXdvcmQpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgaXNSZXN1bHRMaXN0VmlzaWFibGU6IGZhbHNlLFxuICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IDAsXG4gICAgICAgICAga2V5d29yZDogJycsXG4gICAgICAgICAgbGlzdERhdGE6IGxpc3REYXRhLmxlbmd0aCA/IGxpc3REYXRhIDogW10sXG4gICAgICAgICAgc2VsZWN0ZWRJdGVtOiB7fVxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgaXNSZXN1bHRMaXN0VmlzaWFibGU6IGxpc3REYXRhLmxlbmd0aCA+IDAsXG4gICAgICAgICAgbGlzdERhdGE6IGxpc3REYXRhLFxuICAgICAgICAgIGtleXdvcmQ6IGtleXdvcmQsXG4gICAgICAgICAgaXNFcnJvck1lZzogbGlzdERhdGEubGVuZ3RoID4gMCA/IGZhbHNlIDogdHJ1ZVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sIDMwMClcblxuICAgIHRoaXMuaGFuZGxlS2V5Q2hhbmdlID0gKGUpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IHsgbGlzdERhdGEsIHNlbGVjdGVkSW5kZXggfSA9IHRoaXMuaW5pdGFsU3RhdGVcblxuICAgICAgaWYgKE9iamVjdC52YWx1ZXMoQUNUSU9OS0VZUykuaW5jbHVkZXMoZS5rZXkpICYmICFsaXN0RGF0YS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxhc3RJbmRleCA9IGxpc3REYXRhLmxlbmd0aCAtIDFcbiAgICAgIGxldCBuZXh0SW5kZXggPSBzZWxlY3RlZEluZGV4XG5cbiAgICAgIHN3aXRjaCAoZS5rZXkpIHtcbiAgICAgICAgY2FzZSBBQ1RJT05LRVlTLkFSUk9XVVA6XG4gICAgICAgICAgbmV4dEluZGV4ID0gc2VsZWN0ZWRJbmRleCA9PT0gMCA/IGxhc3RJbmRleCA6IG5leHRJbmRleCAtIDFcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IG5leHRJbmRleFxuICAgICAgICAgIH0pXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSBBQ1RJT05LRVlTLkFSUk9XRE9XTjpcbiAgICAgICAgICBuZXh0SW5kZXggPSBzZWxlY3RlZEluZGV4ID09PSBsYXN0SW5kZXggPyAwIDogbmV4dEluZGV4ICsgMVxuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogbmV4dEluZGV4XG4gICAgICAgICAgfSlcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIEFDVElPTktFWVMuRU5URVI6XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW06IGxpc3REYXRhW3NlbGVjdGVkSW5kZXhdLFxuICAgICAgICAgICAgaXNNb2RhbFZpc2lhYmxlOiB0cnVlXG4gICAgICAgICAgfSlcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIEFDVElPTktFWVMuRVNDQVBFOlxuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgaXNNb2RhbFZpc2lhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pXG4gICAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmhhbmRsZUNsaWNrID0gKGUpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50XG4gICAgICBpZiAodGFyZ2V0LmNsb3Nlc3QoJ2J1dHRvbicpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2l0ZW1faW5mbycpKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGlzTW9kYWxWaXNpYWJsZTogZmFsc2VcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB0ZW1wbGF0ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgXG4gICAgICA8bWFpbiBpZD0ncm9vdCc+XG4gICAgICAgIDxoZWFkZXIgY2xhc3M9J2hlYWRlcic+V2VidG9vbnMgU2VhcmNoPC9oZWFkZXI+XG4gICAgICAgIDxkaXYgY2xhc3M9J2NvbnRhaW5lcic+XG4gICAgICAgICAgPFNlYXJjaElucHV0PjwvU2VhcmNoSW5wdXQ+XG4gICAgICAgICAgPEVycm9yTWVzc2FnZT48L0Vycm9yTWVzc2FnZT5cbiAgICAgICAgICA8U2VhcmNoUmVzdWx0TGlzdD48L1NlYXJjaFJlc3VsdExpc3Q+XG4gICAgICAgICAgPFNlYXJjaEl0ZW1JbmZvPjwvU2VhcmNoSXRlbUluZm8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9tYWluPlxuICBgXG4gIH1cblxuICByZW5kZXJDaGlsZENvbXBvbmVudCgpOiB2b2lkIHtcbiAgICBjb25zdCB7XG4gICAgICBrZXl3b3JkLFxuICAgICAgc2VsZWN0ZWRJbmRleCxcbiAgICAgIGxpc3REYXRhLFxuICAgICAgaXNSZXN1bHRMaXN0VmlzaWFibGUsXG4gICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICBpc01vZGFsVmlzaWFibGUsXG4gICAgICBpc0Vycm9yTWVnXG4gICAgfSA9IHRoaXMuaW5pdGFsU3RhdGVcblxuICAgIG5ldyBTZWFyY2hJbnB1dCh7XG4gICAgICBub2RlOiBzZWxlY3RFbCh0aGlzLm5vZGUsICdTZWFyY2hJbnB1dCcpLFxuICAgICAgaW5pdGFsU3RhdGU6IHtcbiAgICAgICAga2V5d29yZDogdGhpcy5pbml0YWxTdGF0ZS5rZXl3b3JkLFxuICAgICAgICBvbklucHV0OiB0aGlzLmhhbmRsZUNoYW5nZVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBlcnJvck1lZyA9IG5ldyBFcnJvck1lZyh7XG4gICAgICBub2RlOiBzZWxlY3RFbCh0aGlzLm5vZGUsICdFcnJvck1lc3NhZ2UnKSxcbiAgICAgIHJlbmRlclN0YXRlS2V5OiBbJ3NlbGVjdGVkSXRlbScsICdzZWxlY3RlZEluZGV4J10sXG4gICAgICBpbml0YWxTdGF0ZTogeyBpc0Vycm9yTWVnLCBrZXl3b3JkLCBpc1Jlc3VsdExpc3RWaXNpYWJsZSB9XG4gICAgfSlcblxuICAgIGNvbnN0IHNlYXJjaFJlc3VsdCA9IG5ldyBTZWFyY2hSZXN1bHQoe1xuICAgICAgbm9kZTogc2VsZWN0RWwodGhpcy5ub2RlLCAnU2VhcmNoUmVzdWx0TGlzdCcpLFxuICAgICAgaW5pdGFsU3RhdGU6IHtcbiAgICAgICAga2V5d29yZCxcbiAgICAgICAgbGlzdERhdGEsXG4gICAgICAgIGlzUmVzdWx0TGlzdFZpc2lhYmxlLFxuICAgICAgICBzZWxlY3RlZEluZGV4LFxuICAgICAgICBvbkNsaWNrOiAoc2VsZWN0ZWRJdGVtOiBJSXRlbSwgaW5kZXg6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtOiBzZWxlY3RlZEl0ZW0sXG4gICAgICAgICAgICBpc01vZGFsVmlzaWFibGU6IHRydWUsXG4gICAgICAgICAgICBzZWxlY3RlZEluZGV4OiBOdW1iZXIoaW5kZXgpXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBzZWFyY2hJdGVtSW5mbyA9IG5ldyBTZWFyY2hJdGVtSW5mbyh7XG4gICAgICBub2RlOiBzZWxlY3RFbCh0aGlzLm5vZGUsICdTZWFyY2hJdGVtSW5mbycpLFxuICAgICAgaW5pdGFsU3RhdGU6IHtcbiAgICAgICAgc2VsZWN0ZWRJdGVtLFxuICAgICAgICBpc01vZGFsVmlzaWFibGVcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgdGhpcy5zdWJzY3JpYmUoc2VhcmNoUmVzdWx0KVxuICAgIHRoaXMuc3Vic2NyaWJlKHNlYXJjaEl0ZW1JbmZvKVxuICAgIHRoaXMuc3Vic2NyaWJlKGVycm9yTWVnKVxuICB9XG5cbiAgc2V0RXZlbnQoKTogdm9pZCB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5oYW5kbGVLZXlDaGFuZ2UpXG4gICAgdGhpcy5ub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVDbGljaylcbiAgfVxuXG4gIGNsZWFyRXZlbnQoKTogdm9pZCB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5oYW5kbGVLZXlDaGFuZ2UpXG4gICAgdGhpcy5ub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVDbGljaylcbiAgfVxufVxuIiwiaW1wb3J0IHR5cGUgeyBJRGVib3VuY2UgfSBmcm9tICcuL3R5cGUnXG5cbmNvbnN0IGRlYm91bmNlOiBJRGVib3VuY2UgPSAoY2FsbGJhY2ssIGRlbGF5KSA9PiB7XG4gIGxldCB0aW1lb3V0OiBudW1iZXJcblxuICByZXR1cm4gZXZlbnQgPT4ge1xuICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dClcbiAgICB9XG5cbiAgICB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIGRlbGF5LCBldmVudClcbiAgfVxufVxuXG5leHBvcnQgeyBkZWJvdW5jZSB9XG4iLCJpbXBvcnQgeyBCQVNFX1VSTCwgUkVRVVNFVF9NRVNTQUdFIH0gZnJvbSAnQGNvbnN0YW50cydcblxuY29uc3QgcmVxdXNldCA9IGFzeW5jICh1cmw6IHN0cmluZyk6IFByb21pc2U8YW55PiA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFJFUVVTRVRfTUVTU0FHRS5IVFRQX0VSUk9SKVxuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG4gICAgcmV0dXJuIGRhdGEud2VidG9vbnNcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGAke1JFUVVTRVRfTUVTU0FHRS5TRVJWRVJfRVJST1J9ICR7ZXJyb3IubWVzc2FnZX1gKVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBhcGkgPSB7XG4gIGdldFdlYlRvb25MaXN0OiBhc3luYyAoa2V5d29yZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+ID0+XG4gICAgcmVxdXNldChgJHtCQVNFX1VSTH0vc2VhcmNoP2tleXdvcmQ9JHtrZXl3b3JkfWApXG59XG4iXSwibmFtZXMiOlsic2VsZWN0RWwiLCJzY29wZSIsImRvY3VtZW50Iiwic2VsZWN0b3IiLCJxdWVyeVNlbGVjdG9yIiwiQ29udmVydFRlbXBsYXRlVG9Db21wb25lbnQiLCJvbGROb2RlIiwidGhpcyIsIm5vZGUiLCJjb21wb25lbnRDaGlsZHJlbiIsIkFycmF5IiwiZnJvbSIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsInRlbXBsYXRlIiwiYm9keSIsImNoaWxkcmVuIiwiY29tcG9uZW50IiwiRG9jdW1lbnRGcmFnbWVudCIsImFwcGVuZCIsImFmdGVyIiwibmV4dFNpYmxpbmciLCJvbGRDU1MiLCJjbGFzc0xpc3QiLCJ2YWx1ZSIsInRyaW0iLCJuZXdDU1MiLCJjc3NWYWx1ZSIsImNsYXNzTmFtZSIsInJlbW92ZSIsIkFDVElPTktFWVMiLCJBUlJPV1VQIiwiQVJST1dET1dOIiwiRU5URVIiLCJFU0NBUEUiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsImluaXRhbFN0YXRlIiwicmVuZGVyU3RhdGVLZXkiLCJTZXQiLCJzdWJzY3JpYmVycyIsImlzTmVlZFJlbmRlciIsImlzTmVlZFVwZGF0ZSIsInNldHVwIiwicmVuZGVyIiwid2luZG93IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2FsbCIsInNldEV2ZW50IiwicmVuZGVyQ2hpbGRDb21wb25lbnQiLCJ1cGRhdGVyIiwiY2xlYXJFdmVudCIsInN1YnNjcmliZSIsImZvckVhY2giLCJzdWJzY3JpYmVyIiwiYWRkIiwibm90aWZ5IiwibmV3U3RhdGUiLCJzZXRTdGF0ZSIsImNoZWNrVXBkYXRhU3RhdGUiLCJyZWZsZWN0TmVlZFJlbmRlciIsInJlZmxlY3RTdGF0ZSIsImtleSIsInNlc3Npb25TdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvciIsIkVycm9yIiwiY3VycmVudFN0YXRlIiwibmV4dFN0YXRlIiwidXBkYXRlZFN0YXRlS2V5cyIsIk9iamVjdCIsImtleXMiLCJzdGF0ZSIsImZpbHRlciIsImluY2x1ZGVzIiwibGVuZ3RoIiwic3RhdGVLZXkiLCJTZWFyY2hJbnB1dCIsIlNlYXJjaElucHV0X19pbnB1dCIsImtleXdvcmQiLCJvbklucHV0IiwiaGFuZGxlSW5wdXQiLCJlIiwidGFyZ2V0IiwiaGFuZGxlRm9jdXMiLCJmb2N1cyIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiU2VhcmNoUmVzdWx0Iiwic2VsZWN0ZWRJbmRleCIsImlzUmVzdWx0TGlzdFZpc2lhYmxlIiwibGlzdERhdGEiLCJyZXN1bHRfbGlzdCIsInNlbGVjdGVkIiwibWF0Y2hlZCIsIm1hdGNoS2V5d29yZCIsIml0ZW0iLCJtYXRjaFRleHQiLCJtYXRjaCIsIlJlZ0V4cCIsInJlcGxhY2UiLCJtYXAiLCJpbmRleCIsInRpdGxlIiwiYXV0aG9yIiwiam9pbiIsIm9uQ2xpY2siLCJoYW5kbGVDbGljayIsIiRsaSIsImNsb3Nlc3QiLCJkYXRhc2V0IiwicGFyc2VJbnQiLCJzY3JvbGxUbyIsIlNlYXJjaEl0ZW1JbmZvIiwiaXNNb2RhbFZpc2lhYmxlIiwic2VsZWN0ZWRJdGVtIiwiaXRlbV9pbmZvIiwibW9kYWwiLCJpbmZvX3RleHRfY29udCIsImltZyIsInNlcnZpY2UiLCJ1cmwiLCJFcnJvck1lZyIsImlzRXJyb3JNZWciLCJlcnJvcl9tZWciLCJub25lUmVzdWx0RXJyb3IiLCJzdXBlciIsImdldEl0ZW0iLCJwYXJzZSIsImhhbmRsZUNoYW5nZSIsImNhbGxiYWNrIiwiZGVsYXkiLCJ0aW1lb3V0IiwiZXZlbnQiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiZGVib3VuY2UiLCJyZXNwb25zZSIsImZldGNoIiwib2siLCJqc29uIiwid2VidG9vbnMiLCJjb25zb2xlIiwibWVzc2FnZSIsImFwaSIsImhhbmRsZUtleUNoYW5nZSIsInZhbHVlcyIsImxhc3RJbmRleCIsIm5leHRJbmRleCIsInByZXZlbnREZWZhdWx0IiwiY29udGFpbnMiLCJlcnJvck1lZyIsInNlYXJjaFJlc3VsdCIsIk51bWJlciIsInNlYXJjaEl0ZW1JbmZvIl0sInNvdXJjZVJvb3QiOiIifQ==